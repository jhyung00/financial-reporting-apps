<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module 4: Credit Risk Analysis</title>
    <!-- New Fun Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            /* Fun & Engaging Palette */
            --primary: #6C63FF;      /* Vibrant Purple */
            --primary-dark: #5a52d5;
            --accent: #FF6584;       /* Coral Pink */
            --bg-gradient: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
            --card-bg: #ffffff;
            --text-main: #2D3436;
            --text-light: #636e72;
            --success: #00B894;      /* Mint Green */
            --warning: #FDCB6E;      /* Mustard */
            --error: #FF7675;        /* Soft Red */
            --shadow: 0 10px 20px rgba(108, 99, 255, 0.15);
            --radius: 16px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Lato', sans-serif;
            background: var(--bg-gradient);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            color: var(--text-main);
        }

        /* --- TOC Sidebar --- */
        .toc-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 1000;
            background: var(--primary);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: var(--shadow);
            font-size: 1.5rem;
            transition: transform 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .toc-btn:hover { transform: scale(1.1); }

        .toc-menu {
            position: fixed;
            top: 0;
            left: -300px;
            width: 280px;
            height: 100%;
            background: white;
            z-index: 999;
            box-shadow: 5px 0 25px rgba(0,0,0,0.1);
            transition: left 0.3s ease;
            padding: 80px 20px 20px 20px;
            overflow-y: auto;
        }
        .toc-menu.open { left: 0; }
        
        .toc-item {
            display: block;
            padding: 12px 15px;
            color: var(--text-main);
            text-decoration: none;
            border-radius: 8px;
            margin-bottom: 5px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }
        .toc-item:hover { background: #f0f0f9; color: var(--primary); }
        .toc-item.active { background: var(--primary); color: white; }
        .toc-section-title {
            font-size: 0.85rem;
            text-transform: uppercase;
            color: var(--text-light);
            margin-top: 15px;
            margin-bottom: 5px;
            padding-left: 10px;
            letter-spacing: 1px;
        }

        /* Fixed Container */
        #slide-deck {
            width: 1280px;
            height: 720px;
            background-color: var(--card-bg);
            position: relative;
            border-radius: var(--radius);
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* Slide Styles */
        .slide {
            flex: 1;
            padding: 40px 80px;
            display: none;
            flex-direction: column;
            animation: fadeIn 0.4s ease-out;
            overflow-y: auto;
        }
        .slide.active { display: flex; }

        @keyframes fadeIn { 
            from { opacity: 0; transform: translateY(10px); } 
            to { opacity: 1; transform: translateY(0); } 
        }

        /* Typography */
        h1, h2, h3 { font-family: 'Poppins', sans-serif; color: var(--text-main); }
        h1 { font-size: 3.5rem; font-weight: 700; color: var(--primary); line-height: 1.1; }
        h2 { font-size: 2.4rem; color: var(--primary); margin-bottom: 25px; position: relative; display: inline-block; }
        h2::after {
            content: ''; display: block; width: 60px; height: 4px; 
            background: var(--accent); border-radius: 2px; margin-top: 8px;
        }
        h3 { color: var(--primary-dark); font-size: 1.5rem; margin-bottom: 15px; margin-top: 5px; }
        p, li { font-size: 1.15rem; line-height: 1.6; color: var(--text-light); margin-bottom: 15px; }
        ul, ol { margin-left: 25px; }

        /* Components */
        .problem-box {
            background: #fff0f3; /* Very light pink */
            border-left: 5px solid var(--accent);
            padding: 25px;
            margin: 20px 0;
            border-radius: 0 12px 12px 0;
        }

        .financial-data {
            font-family: 'Courier New', monospace;
            background: #f8f9fa;
            border: 1px solid #e1e4e8;
            padding: 20px;
            margin: 15px 0;
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 15px;
            font-size: 1rem;
            border-radius: 12px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.02);
        }
        .financial-data.compact { grid-template-columns: auto 1fr; gap: 40px; }
        .data-label { font-weight: 600; color: var(--text-main); }
        .data-val { text-align: right; font-weight: 700; color: var(--primary); }

        /* Buttons */
        .btn-reveal, .btn-reveal-sm {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 50px;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(108, 99, 255, 0.3);
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
        }
        .btn-reveal { padding: 12px 25px; font-size: 1rem; margin-top: 15px; }
        .btn-reveal-sm { padding: 8px 16px; font-size: 0.9rem; margin-top: 8px; background: var(--text-main); }
        .btn-reveal:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(108, 99, 255, 0.4); }

        /* Answers & Reveals */
        .answer {
            margin-top: 20px;
            padding: 20px;
            background-color: #e6fffa;
            border: 1px solid var(--success);
            border-radius: 12px;
            color: #006b54;
            display: none;
        }
        .answer.visible { display: block; animation: slideDown 0.3s ease; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        /* Math Styling */
        .math-eq {
            display: inline-flex;
            align-items: center;
            font-family: 'Times New Roman', serif;
            font-style: italic;
            font-size: 1.4rem;
            margin: 15px 0;
            background: white;
            padding: 15px 30px;
            border-radius: 12px;
            border: 1px solid #eee;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            color: var(--text-main);
        }
        .fraction { display: inline-flex; flex-direction: column; align-items: center; margin: 0 12px; vertical-align: middle; }
        .numerator { border-bottom: 2px solid var(--text-main); padding-bottom: 2px; text-align: center; }
        .denominator { padding-top: 2px; text-align: center; }
        .eq-symbol { margin: 0 12px; font-weight: bold; font-style: normal; color: var(--text-light); }
        .eq-result { font-weight: bold; color: var(--accent); font-style: normal; }

        /* Cards */
        .card-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 30px;
            margin-top: 30px;
            perspective: 1000px;
        }
        .flip-card { background-color: transparent; height: 280px; cursor: pointer; }
        .flip-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform-style: preserve-3d;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }
        .flip-card.flipped .flip-card-inner { transform: rotateY(180deg); }
        .flip-card-front, .flip-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: var(--radius);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 25px;
        }
        .flip-card-front {
            background: linear-gradient(135deg, var(--primary) 0%, #8e84ff 100%);
            color: white;
        }
        .flip-card-back {
            background: white;
            color: var(--text-main);
            transform: rotateY(180deg);
            border: 2px solid var(--primary);
        }

        /* Insight Card */
        .insight-card {
            background: white;
            border-left: 5px solid var(--warning);
            border-radius: 12px;
            padding: 25px;
            box-shadow: var(--shadow);
            margin-top: 25px;
        }
        .insight-card h4 { color: var(--warning); display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }

        /* Z-Score Meter */
        .z-meter-container { width: 100%; margin-top: 30px; position: relative; padding-top: 40px; }
        .z-meter-bar {
            height: 20px;
            width: 100%;
            border-radius: 20px;
            background: linear-gradient(to right, var(--error) 0%, var(--error) 36%, var(--warning) 36%, var(--warning) 60%, var(--success) 60%, var(--success) 100%);
        }
        .z-marker {
            position: absolute;
            top: 0;
            left: 24%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            animation: bounce 2s infinite;
        }
        @keyframes bounce { 0%, 20%, 50%, 80%, 100% {transform: translateX(-50%) translateY(0);} 40% {transform: translateX(-50%) translateY(-10px);} 60% {transform: translateX(-50%) translateY(-5px);} } 

        .z-marker i { color: var(--text-main); font-size: 1.8rem; }
        .z-marker span { font-weight: bold; background: var(--text-main); color: white; padding: 4px 10px; border-radius: 20px; font-size: 0.8rem; margin-bottom: 5px; }
        
        /* Table */
        .moody-table { width: 100%; border-collapse: separate; border-spacing: 0; margin-top: 20px; border-radius: 12px; overflow: hidden; border: 1px solid #eee; }
        .moody-table th { background: var(--primary); color: white; padding: 15px; text-align: center; }
        .moody-table td { padding: 12px; text-align: center; border-bottom: 1px solid #eee; background: white; }
        .moody-table tr:last-child td { border-bottom: none; }
        .moody-table tr.highlight td { background: #e6fffa; color: #006b54; font-weight: bold; }

        /* Quiz */
        .quiz-option {
            background: white;
            border: 2px solid #edf2f7;
            padding: 18px;
            margin-bottom: 12px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }
        .quiz-option:hover { background: #f8faff; border-color: var(--primary); color: var(--primary); }
        .quiz-option.correct { background: #e6fffa; border-color: var(--success); color: var(--success); }
        .quiz-option.incorrect { background: #fff5f5; border-color: var(--error); color: var(--error); }

        /* Navigation */
        .nav-bar {
            height: 70px;
            background: white;
            border-top: 1px solid #eee;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 40px;
            flex-shrink: 0;
        }
        .nav-controls button {
            background: white;
            border: 2px solid #eee;
            color: var(--text-main);
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 30px;
            margin-left: 10px;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            transition: all 0.2s;
        }
        .nav-controls button:hover { border-color: var(--primary); color: var(--primary); }
        .page-num { font-family: 'Poppins', sans-serif; font-weight: 600; color: var(--primary); }

        /* Layouts */
        .cols-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 50px; height: 100%; align-items: start; }
        
        /* Summary Box Animation */
        .summary-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .summary-box {
            background: white; padding: 25px; border-radius: 12px; border-left: 4px solid var(--primary);
            box-shadow: 0 5px 15px rgba(0,0,0,0.05); opacity: 0; transition: opacity 0.5s ease-in, transform 0.5s ease; transform: translateY(20px);
        }
        .summary-box.revealed { opacity: 1; transform: translateY(0); }
    </style>
</head>
<body>

<!-- TOC Toggle Button -->
<button class="toc-btn" onclick="toggleTOC()" title="Table of Contents">
    <i class="fas fa-bars"></i>
</button>

<!-- TOC Sidebar -->
<div class="toc-menu" id="toc-menu">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2 style="font-size: 1.5rem; margin: 0; border: none;">Content Map</h2>
        <i class="fas fa-times" onclick="toggleTOC()" style="cursor: pointer; font-size: 1.2rem; color: var(--text-light);"></i>
    </div>
    
    <div class="toc-section-title">Introduction</div>
    <a class="toc-item" onclick="jumpToSlide(0)">Module Intro</a>
    <a class="toc-item" onclick="jumpToSlide(1)">Core Overview</a>
    
    <div class="toc-section-title">The Market</div>
    <a class="toc-item" onclick="jumpToSlide(2)">Supply & Demand</a>
    <a class="toc-item" onclick="jumpToSlide(3)">Demand: Operating</a>
    <a class="toc-item" onclick="jumpToSlide(4)">Demand: Investing</a>
    <a class="toc-item" onclick="jumpToSlide(6)">Supply: Trade Credit</a>
    
    <div class="toc-section-title">Lending Types</div>
    <a class="toc-item" onclick="jumpToSlide(7)">Bank Loans Overview</a>
    <a class="toc-item" onclick="jumpToSlide(12)">Public Debt</a>
    
    <div class="toc-section-title">Analysis Pillars</div>
    <a class="toc-item" onclick="jumpToSlide(13)">Analysis Process</a>
    <a class="toc-item" onclick="jumpToSlide(17)">Data: 53rd Week</a>
    <a class="toc-item" onclick="jumpToSlide(18)">The 3 Pillars</a>
    <a class="toc-item" onclick="jumpToSlide(19)">Pillar 1: Solvency</a>
    <a class="toc-item" onclick="jumpToSlide(21)">Pillar 2: Coverage</a>
    <a class="toc-item" onclick="jumpToSlide(24)">Pillar 3: Liquidity</a>
    
    <div class="toc-section-title">Ratings & LGD</div>
    <a class="toc-item" onclick="jumpToSlide(26)">Credit Ratings</a>
    <a class="toc-item" onclick="jumpToSlide(30)">Z-Score Model</a>
    <a class="toc-item" onclick="jumpToSlide(32)">Loss Given Default</a>
    
    <div class="toc-section-title">Review</div>
    <a class="toc-item" onclick="jumpToSlide(39)">Quiz Challenge</a>
</div>

<div id="slide-deck">
    
    <!-- SLIDE 1: Intro -->
    <div class="slide active">
        <div style="flex: 1; display: flex; flex-direction: column; justify-content: center; text-align: center; align-items: center;">
            <div style="background: rgba(108, 99, 255, 0.1); padding: 10px 20px; border-radius: 30px; color: var(--primary); font-weight: bold; margin-bottom: 20px;">Module 4</div>
            <h1>Credit Risk Analysis</h1>
            <p style="font-size: 1.8rem; margin-top: 10px; color: var(--text-light);">From Raw Data to Ratings</p>
            
            <div style="margin-top: 60px; display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; width: 100%;">
                <div style="padding: 20px; border: 2px dashed #e0e0e0; border-radius: 20px;">
                    <i class="fas fa-chart-line" style="font-size: 2rem; color: var(--accent); margin-bottom: 10px;"></i>
                    <p style="margin:0; font-weight: 600;">Market Dynamics</p>
                </div>
                <div style="padding: 20px; border: 2px dashed #e0e0e0; border-radius: 20px;">
                    <i class="fas fa-calculator" style="font-size: 2rem; color: var(--success); margin-bottom: 10px;"></i>
                    <p style="margin:0; font-weight: 600;">Calculations</p>
                </div>
                <div style="padding: 20px; border: 2px dashed #e0e0e0; border-radius: 20px;">
                    <i class="fas fa-shield-alt" style="font-size: 2rem; color: var(--primary); margin-bottom: 10px;"></i>
                    <p style="margin:0; font-weight: 600;">Risk Ratings</p>
                </div>
            </div>
        </div>
    </div>

    <!-- SLIDE 2: Module Overview -->
    <div class="slide">
        <h2>What We'll Cover</h2>
        <div class="cols-2">
            <div>
                <h3><i class="fas fa-check-circle" style="color:var(--success)"></i> Core Competencies</h3>
                <ul>
                    <li>Understand the Market for Credit (Supply/Demand).</li>
                    <li>Perform Adjustments (53rd Week, Off-Balance Sheet).</li>
                    <li>Calculate the 3 Pillars: Solvency, Coverage, Liquidity.</li>
                </ul>
            </div>
            <div>
                <h3><i class="fas fa-rocket" style="color:var(--accent)"></i> Advanced Skills</h3>
                <ul>
                    <li>Apply Credit Rating Frameworks (S&P and Moody's).</li>
                    <li>Predict Bankruptcy (Altman Z-Score).</li>
                    <li>Assess Loss Given Default.</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- SLIDE 3: Market -->
    <div class="slide">
        <h2>The Credit Market</h2>
        <div class="cols-2">
            <div>
                <p>Just like products, money has a market driven by <strong>Supply</strong> and <strong>Demand</strong>.</p>
                <div class="problem-box">
                    <p><strong>ü§î Who are the players?</strong></p>
                    <p>Think about who needs cash and who has cash.</p>
                </div>
                <button class="btn-reveal" onclick="toggleAnswer(this)">Reveal Participants</button>
                <div class="answer">
                    <ul>
                        <li><strong>Demand (Borrowers):</strong> Companies needing cash for Operations, Investing, or Refinancing.</li>
                        <li><strong>Supply (Lenders):</strong> Trade Creditors, Banks, Public Debt Investors.</li>
                    </ul>
                </div>
            </div>
            <div style="display: flex; align-items: center; justify-content: center;">
                <img src="https://placehold.co/500x350/6C63FF/ffffff?text=$$$Flow$$$" style="width: 100%; border-radius: 20px; box-shadow: var(--shadow);" alt="Graph">
            </div>
        </div>
    </div>

    <!-- SLIDE 4: Demand - Operating -->
    <div class="slide">
        <h2>Demand: Operating Activities</h2>
        <p>Why do companies need cash for daily ops?</p>
        <div class="cols-2">
            <div style="background: white; padding: 30px; border-radius: 20px; box-shadow: var(--shadow);">
                <button class="btn-reveal" style="margin-top:0; width:100%;" onclick="toggleAnswer(this)" data-target="op-list">Reveal Drivers</button>
                <ul id="op-list" class="answer" style="padding-left: 20px; margin-top: 15px; border:none; background: transparent;">
                    <li><strong>Cyclical Needs:</strong> Making goods before selling them.</li>
                    <li><strong>Seasonality:</strong> Building inventory for holidays.</li>
                    <li><strong>Operating Losses:</strong> Covering cash burn during slumps.</li>
                </ul>
            </div>
            <div class="insight-card">
                <h4><i class="fas fa-lightbulb"></i> Thought Bubble</h4>
                <p>Is lending to cover losses always "High Risk"? Not necessarily. It can be a bridge across a temporary gap (like COVID shutdowns).</p>
            </div>
        </div>
    </div>

    <!-- SLIDE 5: Demand - Investing -->
    <div class="slide">
        <h2>Demand: Investing Activities</h2>
        <p>Growth is expensive! Click the cards to see where the big money goes.</p>
        <div class="card-container" style="grid-template-columns: 1fr 1fr; gap: 40px;">
            <div class="flip-card" onclick="this.classList.toggle('flipped')">
                <div class="flip-card-inner">
                    <div class="flip-card-front">
                        <i class="fas fa-industry" style="font-size: 3rem; margin-bottom: 20px;"></i>
                        <h3>CAPEX</h3>
                        <p style="color:white; opacity:0.9;">Machinery & Plants</p>
                    </div>
                    <div class="flip-card-back">
                        <h3>PP&E</h3>
                        <p>Purchasing long-term assets. Usually financed with Term Loans that match the asset's lifespan.</p>
                    </div>
                </div>
            </div>
            <div class="flip-card" onclick="this.classList.toggle('flipped')">
                <div class="flip-card-inner">
                    <div class="flip-card-front" style="background: linear-gradient(135deg, var(--accent) 0%, #ff8fa3 100%);">
                        <i class="fas fa-handshake" style="font-size: 3rem; margin-bottom: 20px;"></i>
                        <h3>M&A</h3>
                        <p style="color:white; opacity:0.9;">Buying Companies</p>
                    </div>
                    <div class="flip-card-back" style="border-color: var(--accent);">
                        <h3>Mergers</h3>
                        <p>Requires massive upfront capital. Often starts with "bridge loans" before issuing bonds.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SLIDE 6: Supply - Trade Credit -->
    <div class="slide">
        <h2>Supply: Trade Credit</h2>
        <div class="cols-2">
            <div>
                <h3>"The First Line of Defense"</h3>
                <p>When suppliers let you pay later (e.g., Net 30 terms).</p>
                <ul>
                    <li>Routine & non-interest bearing.</li>
                    <li>Often includes discounts for early payment (2/10 Net 30).</li>
                </ul>
            </div>
            <div class="problem-box">
                <p><strong>‚ö†Ô∏è Why is it a warning sign?</strong></p>
                <p>If suppliers stop shipping (cut off credit), operations halt immediately. It's often the first domino to fall.</p>
            </div>
        </div>
    </div>

    <!-- SLIDE 7: Supply - Bank Loans -->
    <div class="slide">
        <h2>Supply: Bank Loans</h2>
        <p>Banks tailor products to specific needs. <strong>Click to explore.</strong></p>
        <div class="card-container" style="grid-template-columns: repeat(4, 1fr); gap: 15px;">
            <div class="flip-card" onclick="this.classList.toggle('flipped')">
                <div class="flip-card-inner">
                    <div class="flip-card-front">
                        <i class="fas fa-sync-alt" style="font-size: 2rem; margin-bottom: 10px;"></i>
                        <h3 style="color:white; font-size:1.1rem;">Revolver</h3>
                    </div>
                    <div class="flip-card-back">
                        <p><strong>Like a Credit Card</strong></p>
                        <p style="font-size: 0.9rem;">Borrow, pay back, borrow again. Used for seasonal working capital.</p>
                    </div>
                </div>
            </div>
            <div class="flip-card" onclick="this.classList.toggle('flipped')">
                <div class="flip-card-inner">
                    <div class="flip-card-front">
                        <i class="fas fa-file-contract" style="font-size: 2rem; margin-bottom: 10px;"></i>
                        <h3 style="color:white; font-size:1.1rem;">Line of Credit</h3>
                    </div>
                    <div class="flip-card-back">
                        <p><strong>Insurance</strong></p>
                        <p style="font-size: 0.9rem;">Back-up liquidity. Often just a standby letter of credit.</p>
                    </div>
                </div>
            </div>
            <div class="flip-card" onclick="this.classList.toggle('flipped')">
                <div class="flip-card-inner">
                    <div class="flip-card-front">
                        <i class="fas fa-calendar-check" style="font-size: 2rem; margin-bottom: 10px;"></i>
                        <h3 style="color:white; font-size:1.1rem;">Term Loan</h3>
                    </div>
                    <div class="flip-card-back">
                        <p><strong>Like a Car Loan</strong></p>
                        <p style="font-size: 0.9rem;">Specific amount, specific schedule. Used for PP&E.</p>
                    </div>
                </div>
            </div>
            <div class="flip-card" onclick="this.classList.toggle('flipped')">
                <div class="flip-card-inner">
                    <div class="flip-card-front">
                        <i class="fas fa-home" style="font-size: 2rem; margin-bottom: 10px;"></i>
                        <h3 style="color:white; font-size:1.1rem;">Mortgage</h3>
                    </div>
                    <div class="flip-card-back">
                        <p><strong>Real Estate</strong></p>
                        <p style="font-size: 0.9rem;">Secured by property. Lender gets the building if you default.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SLIDE 8: Bank Loans Deep Dive (Term) -->
    <div class="slide">
        <h2>Deep Dive: Term Loans</h2>
        <div class="cols-2">
            <div>
                <h3>Key Mechanics</h3>
                <p>Typically used for assets (Machines, Factories).</p>
                <div class="financial-data">
                    <div class="data-row"><span class="data-label">Interest:</span> <span class="data-val">Floating (SOFR + Spread)</span></div>
                    <div class="data-row"><span class="data-label">Amortization:</span> <span class="data-val">Principal paid over time</span></div>
                </div>
                <p style="font-size: 0.9rem; margin-top: 10px;"><em>*SOFR = Secured Overnight Financing Rate (The new benchmark)</em></p>
            </div>
            <div class="insight-card">
                <h4><i class="fas fa-coins"></i> The "Spread"</h4>
                <p>The bank charges a base rate (SOFR) plus a "Risk Premium" (Spread). </p>
                <p><strong>Risky Client = Higher Spread.</strong></p>
            </div>
        </div>
    </div>

    <!-- SLIDE 9: Bank Loans Deep Dive (Mortgages) -->
    <div class="slide">
        <h2>Deep Dive: Mortgages</h2>
        <div class="cols-2">
            <div>
                <p>Secured by real estate property.</p>
                <ul>
                    <li><strong>Terms:</strong> Long (10-30 years).</li>
                    <li><strong>Security:</strong> The lender has a "Lien" on the building.</li>
                </ul>
            </div>
            <div class="problem-box">
                <p><strong>üî• Bankruptcy Scenario</strong></p>
                <p>If the company goes bust, who gets the building?</p>
                <button class="btn-reveal-sm" onclick="toggleAnswer(this)">Reveal</button>
                <div class="answer" style="background: white; border:none; padding:10px 0;">
                    <p>The Mortgage Holder is a <strong>Secured Creditor</strong>. They get paid from the building sale before anyone else sees a dime.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- SLIDE 10: Leases -->
    <div class="slide">
        <h2>Lease Financing</h2>
        <p>Rent vs. Buy? In credit analysis, it's often treated the same.</p>
        <div class="cols-2">
            <div>
                <h3>Types</h3>
                <ul>
                    <li><strong>Finance Lease:</strong> You effectively own it. (Asset + Debt on Balance Sheet).</li>
                    <li><strong>Operating Lease:</strong> Like renting a car for a week.</li>
                </ul>
            </div>
            <div class="insight-card" style="border-left-color: var(--primary);">
                <h4><i class="fas fa-search-dollar"></i> Analyst Tip</h4>
                <p>S&P treats almost <strong>ALL</strong> lease liabilities as Debt when calculating solvency ratios, regardless of accounting classification.</p>
                <p><em>"If you have to pay it to stay in business, it's debt."</em></p>
            </div>
        </div>
    </div>

    <!-- SLIDE 11: Public Debt -->
    <div class="slide">
        <h2>Public Debt Markets</h2>
        <p>When banks aren't enough, companies go public.</p>
        <div class="card-container" style="grid-template-columns: 1fr 1fr; gap: 40px;">
            <div class="flip-card" onclick="this.classList.toggle('flipped')">
                <div class="flip-card-inner">
                    <div class="flip-card-front" style="background: var(--text-main);">
                        <h3>Commercial Paper</h3>
                        <p style="color: white; margin-top: 10px;">(Short Term)</p>
                    </div>
                    <div class="flip-card-back" style="border-color: var(--text-main);">
                        <ul style="text-align: left;">
                            <li>Matures < 270 days.</li>
                            <li>Exempt from SEC registration.</li>
                            <li>Used for Working Capital.</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="flip-card" onclick="this.classList.toggle('flipped')">
                <div class="flip-card-inner">
                    <div class="flip-card-front" style="background: var(--text-main);">
                        <h3>Bonds</h3>
                        <p style="color: white; margin-top: 10px;">(Long Term)</p>
                    </div>
                    <div class="flip-card-back" style="border-color: var(--text-main);">
                        <ul style="text-align: left;">
                            <li>Traded on exchanges.</li>
                            <li><strong>Debenture:</strong> Unsecured.</li>
                            <li><strong>Bond:</strong> Usually Secured.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SLIDE 12: Analysis Process -->
    <div class="slide">
        <h2>The Risk Analysis Process</h2>
        <p>How do we quantify the risk?</p>
        <div class="problem-box" style="text-align: center;">
            <p style="font-size: 1.3rem; color: var(--text-main);"><strong>Expected Loss = Chance of Default √ó Loss Given Default</strong></p>
        </div>
        <p><strong>The 4-Step Process:</strong></p>
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-top: 20px;">
            <div style="background: white; padding: 20px; border-radius: 15px; box-shadow: var(--shadow);">
                <div style="color: var(--primary); font-weight: bold;">1. Purpose</div>
                <p style="font-size: 0.9rem;">Why do they need it? (Growth vs Distress)</p>
            </div>
            <div style="background: white; padding: 20px; border-radius: 15px; box-shadow: var(--shadow);">
                <div style="color: var(--primary); font-weight: bold;">2. Macro</div>
                <p style="font-size: 0.9rem;">Industry competition & Porter's 5 Forces.</p>
            </div>
            <div style="background: white; padding: 20px; border-radius: 15px; box-shadow: var(--shadow);">
                <div style="color: var(--primary); font-weight: bold;">3. Financials</div>
                <p style="font-size: 0.9rem;">Historical ratio analysis.</p>
            </div>
            <div style="background: white; padding: 20px; border-radius: 15px; box-shadow: var(--shadow);">
                <div style="color: var(--primary); font-weight: bold;">4. Future</div>
                <p style="font-size: 0.9rem;">Forecasts & Projections.</p>
            </div>
        </div>
    </div>

    <!-- SLIDE 13: Data Reliability -->
    <div class="slide">
        <h2>Before We Calculate...</h2>
        <p>We must ensure data quality. A classic trap: <strong>The 53rd Week</strong>.</p>
        <div class="cols-2">
            <div>
                <p>Retailers often end fiscal years on a Saturday. Every 5-6 years, this creates a 53-week year.</p>
                <div class="problem-box">
                    <p><strong>Trap:</strong> Comparing a 53-week year to a 52-week year makes growth look artificially high.</p>
                </div>
            </div>
            <div>
                <h3 style="margin-top:0;">Example: Kraft Heinz</h3>
                <div class="financial-data">
                    <div class="data-row"><span class="data-label">Reported Sales (53 wks):</span> <span class="data-val">$25,985 M</span></div>
                </div>
                <button class="btn-reveal" onclick="toggleAnswer(this)">Normalize to 52 Weeks</button>
                <div class="answer">
                    <div class="math-eq" style="width:100%; justify-content: center;">
                        <span>25,985</span> <span class="eq-symbol">√ó</span>
                        <div class="fraction"><span class="numerator">52</span><span class="denominator">53</span></div>
                        <span class="eq-symbol">=</span> <span class="eq-result">$25,491 M</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SLIDE 14: The 3 Pillars Intro -->
    <div class="slide">
        <h2>The 3 Pillars of Credit Analysis</h2>
        <p>The core framework for Step 3 (Financial Analysis).</p>
        <div class="card-container">
            <div class="flip-card" onclick="this.classList.toggle('flipped')">
                <div class="flip-card-inner">
                    <div class="flip-card-front" style="background: var(--primary);">
                        <i class="fas fa-balance-scale" style="font-size: 3rem; margin-bottom: 20px;"></i>
                        <h3>1. Solvency</h3>
                        <p style="color:white; font-size: 0.9rem;">Capital Structure</p>
                    </div>
                    <div class="flip-card-back">
                        <h3>Solvency</h3>
                        <p>How much debt vs equity?</p>
                        <p><strong>Metric:</strong> Debt-to-Equity</p>
                    </div>
                </div>
            </div>
            <div class="flip-card" onclick="this.classList.toggle('flipped')">
                <div class="flip-card-inner">
                    <div class="flip-card-front" style="background: var(--accent);">
                        <i class="fas fa-money-bill-wave" style="font-size: 3rem; margin-bottom: 20px;"></i>
                        <h3>2. Coverage</h3>
                        <p style="color:white; font-size: 0.9rem;">Ability to Pay</p>
                    </div>
                    <div class="flip-card-back" style="border-color: var(--accent);">
                        <h3>Coverage</h3>
                        <p>Can earnings cover interest?</p>
                        <p><strong>Metric:</strong> Times Interest Earned</p>
                    </div>
                </div>
            </div>
            <div class="flip-card" onclick="this.classList.toggle('flipped')">
                <div class="flip-card-inner">
                    <div class="flip-card-front" style="background: var(--success);">
                        <i class="fas fa-hourglass-half" style="font-size: 3rem; margin-bottom: 20px;"></i>
                        <h3>3. Liquidity</h3>
                        <p style="color:white; font-size: 0.9rem;">Right Now</p>
                    </div>
                    <div class="flip-card-back" style="border-color: var(--success);">
                        <h3>Liquidity</h3>
                        <p>Cash access for short-term bills.</p>
                        <p><strong>Metric:</strong> Current Ratio</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SLIDE 15: Pillar 1 Solvency -->
    <div class="slide">
        <h2>Pillar 1: Solvency (Verizon)</h2>
        <div class="cols-2">
            <div>
                <div class="financial-data">
                    <div class="data-row"><span class="data-label">Liabilities:</span> <span class="data-val">$287,217 M</span></div>
                    <div class="data-row"><span class="data-label">Equity:</span> <span class="data-val">$92,463 M</span></div>
                </div>
                <div class="problem-box">
                    <p>Calculate <strong>Liabilities-to-Equity</strong>.</p>
                </div>
                <button class="btn-reveal" onclick="toggleAnswer(this)" data-target="ans-solvency">Calculate</button>
            </div>
            <div>
                <div class="answer" id="ans-solvency">
                    <div class="math-eq">
                        <div class="fraction">
                            <span class="numerator">287,217</span>
                            <span class="denominator">92,463</span>
                        </div>
                        <span class="eq-symbol">=</span>
                        <span class="eq-result">3.11</span>
                    </div>
                    <div class="insight-card" style="margin-top: 10px;">
                        <h4>Interpretation</h4>
                        <p>Verizon uses $3.11 of debt for every $1 of equity. This is high leverage, typical for Telecom/Utilities.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SLIDE 16: Pillar 2 Coverage -->
    <div class="slide">
        <h2>Pillar 2: Coverage (TIE)</h2>
        <div class="cols-2">
            <div>
                <div class="financial-data">
                    <div class="data-row"><span class="data-label">EBIT:</span> <span class="data-val">$30,467 M</span></div>
                    <div class="data-row"><span class="data-label">Interest:</span> <span class="data-val">$3,613 M</span></div>
                </div>
                <div class="problem-box">
                    <p>Calculate <strong>Times Interest Earned</strong>.</p>
                </div>
                <button class="btn-reveal" onclick="toggleAnswer(this)" data-target="ans-coverage">Calculate</button>
            </div>
            <div>
                <div class="answer" id="ans-coverage">
                    <div class="math-eq">
                        <div class="fraction">
                            <span class="numerator">30,467</span>
                            <span class="denominator">3,613</span>
                        </div>
                        <span class="eq-symbol">=</span>
                        <span class="eq-result">8.43x</span>
                    </div>
                    <p style="margin-top:10px;"><strong>Verdict:</strong> Strong. They can pay their interest bill 8 times over.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- SLIDE 17: Pillar 2 Cash Flow -->
    <div class="slide">
        <h2>Pillar 2: Coverage (Cash Flow)</h2>
        <p>Earnings are great, but Cash is King. Let's look at Free Cash Flow.</p>
        <div class="financial-data compact">
            <div class="data-row"><span class="data-label">CFO:</span> <span class="data-val">$37,141 M</span></div>
            <div class="data-row"><span class="data-label">CAPEX:</span> <span class="data-val">$23,087 M</span></div>
            <div class="data-row"><span class="data-label">Total Debt:</span> <span class="data-val">$176,331 M</span></div>
        </div>
        <button class="btn-reveal" onclick="toggleAnswer(this)">Calculate FCF Coverage</button>
        <div class="answer">
            <div class="math-eq">
                <div class="fraction">
                    <span class="numerator">37,141 - 23,087</span>
                    <span class="denominator">176,331</span>
                </div>
                <span class="eq-symbol">=</span>
                <span class="eq-result">8%</span>
            </div>
            <p><strong>Contrast:</strong> While Earnings coverage (8.43x) looked huge, FCF coverage is tight (8%). This highlights the heavy cost of maintaining the network.</p>
        </div>
    </div>

    <!-- SLIDE 18: Pillar 3 Liquidity -->
    <div class="slide">
        <h2>Pillar 3: Liquidity</h2>
        <div class="cols-2">
            <div>
                <div class="financial-data">
                    <div class="data-row"><span class="data-label">Current Assets:</span> <span class="data-val">$37,857 M</span></div>
                    <div class="data-row"><span class="data-label">Current Liab:</span> <span class="data-val">$50,171 M</span></div>
                </div>
                <div class="problem-box">
                    <p>Calculate <strong>Current Ratio</strong>.</p>
                </div>
                <button class="btn-reveal" onclick="toggleAnswer(this)" data-target="ans-liquidity">Calculate</button>
            </div>
            <div>
                <div class="answer" id="ans-liquidity">
                    <div class="math-eq">
                        <div class="fraction">
                            <span class="numerator">37,857</span>
                            <span class="denominator">50,171</span>
                        </div>
                        <span class="eq-symbol">=</span>
                        <span class="eq-result">0.75</span>
                    </div>
                    <div class="insight-card">
                        <h4><i class="fas fa-exclamation-triangle"></i> Is this bad?</h4>
                        <p>Under 1.0 means negative working capital. For a giant like Verizon, it's efficiency. For a small business, it's panic time.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SLIDE 19: Ratings Intro -->
    <div class="slide">
        <h2>Credit Ratings: The Scorecard</h2>
        <div class="cols-2">
            <div>
                <p>Agencies like S&P and Moody's condense all this analysis into a letter grade.</p>
                <ul>
                    <li><strong>Investment Grade:</strong> BBB- / Baa3 and above. Safe for pension funds.</li>
                    <li><strong>Speculative (Junk):</strong> BB+ / Ba1 and below. High yield, high risk.</li>
                </ul>
            </div>
            <div>
                <button class="btn-reveal" style="margin-top:0;" onclick="toggleAnswer(this)" data-target="rating-table">Show Scale</button>
                <div id="rating-table" class="answer visible">
                    <table class="moody-table">
                        <thead>
                            <tr><th>S&P</th><th>Moody's</th><th>Desc</th></tr>
                        </thead>
                        <tbody>
                            <tr class="highlight"><td>AAA</td><td>Aaa</td><td>Prime</td></tr>
                            <tr><td>AA</td><td>Aa</td><td>High Grade</td></tr>
                            <tr><td>A</td><td>A</td><td>Upper Med</td></tr>
                            <tr class="highlight"><td>BBB</td><td>Baa</td><td>Inv. Grade Floor</td></tr>
                            <tr style="border-top: 2px solid var(--error);"><td>BB</td><td>Ba</td><td>Junk</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- SLIDE 20: Ratings Impact -->
    <div class="slide">
        <h2>Why Ratings Matter</h2>
        <div class="card-container" style="grid-template-columns: 1fr 1fr; gap: 40px;">
            <div class="flip-card" onclick="this.classList.toggle('flipped')">
                <div class="flip-card-inner">
                    <div class="flip-card-front" style="background: var(--text-main);">
                        <i class="fas fa-percent" style="font-size: 3rem; margin-bottom: 20px;"></i>
                        <h3 style="color:white;">Cost of Debt</h3>
                    </div>
                    <div class="flip-card-back" style="border-color: var(--text-main);">
                        <p>Lower ratings = Higher interest rates.</p>
                        <p>Aaa might yield 3.6%, while Baa yields 4.8%.</p>
                    </div>
                </div>
            </div>
            <div class="flip-card" onclick="this.classList.toggle('flipped')">
                <div class="flip-card-inner">
                    <div class="flip-card-front" style="background: var(--text-main);">
                        <i class="fas fa-door-open" style="font-size: 3rem; margin-bottom: 20px;"></i>
                        <h3 style="color:white;">Access</h3>
                    </div>
                    <div class="flip-card-back" style="border-color: var(--text-main);">
                        <p>Many institutional investors (like Pension funds) are legally banned from buying "Junk" debt.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SLIDE 21: Moody's Matrix -->
    <div class="slide">
        <h2>Moody's Metrics Matrix</h2>
        <p>Where do the numbers fit? (Based on 2022 Medians)</p>
        <div style="overflow-x:auto;">
            <table class="moody-table">
                <thead>
                    <tr>
                        <th>Rating</th>
                        <th>Debt / EBITDA</th>
                        <th>EBITA / Interest</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="highlight"><td>Aaa</td><td>1.1x</td><td>21.0x</td></tr>
                    <tr><td>Aa</td><td>1.3x</td><td>12.0x</td></tr>
                    <tr><td>A</td><td>2.1x</td><td>15.1x</td></tr>
                    <tr class="highlight"><td>Baa</td><td>2.6x</td><td>10.2x</td></tr>
                    <tr><td>Ba (Junk)</td><td>3.3x</td><td>10.8x</td></tr>
                    <tr><td>B</td><td>6.0x</td><td>7.2x</td></tr>
                </tbody>
            </table>
        </div>
        <div class="problem-box">
            <p><strong>Exercise:</strong> Company X has Debt/EBITDA of <strong>1.3x</strong>. What rating is that?</p>
            <button class="btn-reveal-sm" onclick="toggleAnswer(this)">Check</button>
            <div class="answer" style="background:transparent; border:none; padding:5px 0;">
                <p><strong>Aa</strong>. Very strong.</p>
            </div>
        </div>
    </div>

    <!-- SLIDE 22: Z-Score -->
    <div class="slide">
        <h2>Predicting Bankruptcy: Z-Score</h2>
        <p>A formula to predict distress within 2 years.</p>
        
        <div class="financial-data" style="text-align: center; margin-bottom: 20px;">
            <div class="data-row"><span>Verizon Calc:</span> <span class="data-val">1.20</span></div>
        </div>

        <div class="z-meter-container">
            <div class="z-marker">
                <span>Verizon 1.2</span>
                <i class="fas fa-caret-down"></i>
            </div>
            <div class="z-meter-bar"></div>
            <div style="display:flex; justify-content:space-between; margin-top:5px; font-size:0.8rem; font-weight:bold;">
                <span style="color:var(--error)">Distress (< 1.8)</span>
                <span style="color:var(--warning)">Gray Zone</span>
                <span style="color:var(--success)">Safe (> 3.0)</span>
            </div>
        </div>

        <div class="insight-card">
            <h4>Analyst's Dilemma</h4>
            <p>Verizon scores 1.2 (Distress) but is rated BBB+ (Safe). Why? <strong>Qualitative Factors.</strong> A monopoly-like utility isn't the same as a struggling retailer.</p>
        </div>
    </div>

    <!-- SLIDE 23: LGD Hierarchy -->
    <div class="slide">
        <h2>Loss Given Default (LGD)</h2>
        <p>If they crash, who gets paid first?</p>
        <div class="cols-2">
            <div>
                <ul style="list-style: none; padding: 0;">
                    <li style="background: var(--success); color: white; padding: 15px; border-radius: 10px; margin-bottom: 10px;">1. Secured Debt (Mortgages)</li>
                    <li style="background: #a29bfe; color: white; padding: 15px; border-radius: 10px; margin-bottom: 10px;">2. Senior Unsecured Debt</li>
                    <li style="background: var(--warning); color: white; padding: 15px; border-radius: 10px; margin-bottom: 10px;">3. Subordinated Debt</li>
                    <li style="background: var(--error); color: white; padding: 15px; border-radius: 10px;">4. Equity (Shareholders)</li>
                </ul>
            </div>
            <div class="insight-card" style="margin-top:0;">
                <h4>The Lender's Toolkit</h4>
                <p>Lenders use <strong>Covenants</strong> (Rules) and <strong>Collateral</strong> (Assets) to move themselves up this list or prevent the crash entirely.</p>
            </div>
        </div>
    </div>

    <!-- SLIDE 24: Summary -->
    <div class="slide">
        <h2>Module Summary</h2>
        <div class="summary-grid">
            <div id="summary-1" class="summary-box">
                <h3>The Context</h3>
                <p>Supply & Demand. Growth Loans vs. Distress Loans.</p>
            </div>
            <div id="summary-2" class="summary-box">
                <h3>The Analysis</h3>
                <p>3 Pillars: Solvency, Coverage, Liquidity.</p>
            </div>
            <div id="summary-3" class="summary-box">
                <h3>The Result</h3>
                <p>Ratings (S&P/Moody's) and LGD Hierarchy.</p>
            </div>
            <div id="summary-4" class="summary-box">
                <h3>The Goal</h3>
                <p>Quantifying Downside Risk.</p>
            </div>
        </div>
        <div style="text-align: center; margin-top: 30px;">
            <button id="summary-btn" class="btn-reveal" onclick="revealNextSummary()">Reveal Summary</button>
        </div>
    </div>

    <!-- SLIDE 25: QUIZ -->
    <div class="slide">
        <h2>Quiz Challenge</h2>
        <div style="max-width: 800px; margin: 0 auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3>Question <span id="quiz-progress">1</span> / 10</h3>
                <button onclick="resetQuiz()" style="background:none; border:none; cursor: pointer; color:var(--text-light);"><i class="fas fa-redo"></i> Restart</button>
            </div>

            <div id="quiz-container" class="problem-box" style="background: white; border: 1px solid #eee;">
                <p id="quiz-question" style="font-size: 1.3rem; margin-bottom: 25px; font-weight: 700; color: var(--text-main);"></p>
                <div id="quiz-options"></div>
                <div id="quiz-feedback" class="answer" style="margin-top: 15px;"></div>
                <button id="next-q-btn" onclick="nextQuestion()" class="btn-reveal" style="display:none; margin-top: 20px;">Next Question</button>
            </div>
        </div>
    </div>

    <!-- Controls -->
    <div class="nav-bar">
        <span class="page-num" id="page-num">Slide 1 / 25</span>
        <div class="nav-controls">
            <button onclick="changeSlide(-1)"><i class="fas fa-arrow-left"></i> Prev</button>
            <button onclick="changeSlide(1)">Next <i class="fas fa-arrow-right"></i></button>
        </div>
    </div>

</div>

<script>
    let currentSlide = 0;
    const slides = document.querySelectorAll('.slide');
    const pageNum = document.getElementById('page-num');
    let summaryStep = 0;

    // --- Navigation Logic ---
    function updateSlide() {
        slides.forEach((slide, index) => {
            slide.classList.remove('active');
            if (index === currentSlide) {
                slide.classList.add('active');
            }
        });
        pageNum.innerText = `Slide ${currentSlide + 1} / ${slides.length}`;
        
        // Highlight TOC item
        const tocItems = document.querySelectorAll('.toc-item');
        tocItems.forEach(item => item.classList.remove('active'));
        // Logic to highlight closest TOC item would go here, 
        // simplified for now by just letting clicks set context.
    }

    function changeSlide(direction) {
        currentSlide += direction;
        if (currentSlide < 0) currentSlide = 0;
        if (currentSlide >= slides.length) currentSlide = slides.length - 1;
        updateSlide();
    }

    function jumpToSlide(index) {
        currentSlide = index;
        updateSlide();
        toggleTOC(); // Close menu
    }

    function toggleTOC() {
        const menu = document.getElementById('toc-menu');
        menu.classList.toggle('open');
    }

    // --- Interaction Logic ---
    function toggleAnswer(btn) {
        let answerDiv;
        const targetId = btn.getAttribute('data-target');
        
        // Try to find the target element
        if (targetId) {
            answerDiv = document.getElementById(targetId);
        } else {
            answerDiv = btn.nextElementSibling;
        }

        // Safety check: if no answer div is found, exit early
        if (!answerDiv) {
            console.warn("No answer div found for button:", btn);
            return; 
        }

        if (answerDiv.classList.contains('visible')) {
            answerDiv.classList.remove('visible');
            btn.innerText = btn.innerText.replace("Hide", "Reveal");
        } else {
            answerDiv.classList.add('visible');
            btn.innerText = btn.innerText.replace("Reveal", "Hide");
        }
    }

    function revealNextSummary() {
        summaryStep++;
        const box = document.getElementById(`summary-${summaryStep}`);
        if(box) {
            box.classList.add('revealed');
        }
        if(summaryStep >= 4) {
            document.getElementById('summary-btn').style.display = 'none';
        }
    }

    // --- QUIZ DATA ---
    const quizData = [
        { q: "What is the primary purpose of a Revolver?", options: ["Buying real estate", "Short-term working capital", "Funding a merger", "Avoiding taxes"], correct: 1, explanation: "Revolvers act like corporate credit cards for short-term needs." },
        { q: "A Term Loan usually matches its duration to:", options: ["The asset's useful life", "270 days", "The CEO's contract", "Inventory turnover"], correct: 0, explanation: "You pay for the machine over the time you use the machine." },
        { q: "Commercial Paper must mature within:", options: ["30 Days", "90 Days", "270 Days", "1 Year"], correct: 2, explanation: "270 days is the limit to avoid SEC registration." },
        { q: "How are Operating Leases treated by analysts?", options: ["As Expenses", "As Debt", "Ignored", "As Equity"], correct: 1, explanation: "Analysts capitalize them. If you have to pay it, it's debt." },
        { q: "Which rating is 'Investment Grade'?", options: ["Ba1", "BBB-", "Caa", "D"], correct: 1, explanation: "BBB- (S&P) or Baa3 (Moody's) is the floor for Investment Grade." },
        { q: "What happens to Debt/EBITDA as ratings get worse?", options: ["It decreases", "Stays same", "It increases", "Becomes negative"], correct: 2, explanation: "Lower ratings mean higher leverage (more debt relative to earnings)." },
        { q: "Why adjust for a 53rd week?", options: ["To punish them", "Comparability", "Tax reasons", "GAAP rules"], correct: 1, explanation: "To compare apples to apples. Otherwise, growth looks fake." },
        { q: "Verizon has a distress Z-Score but good rating. Why?", options: ["Math error", "Corruption", "Qualitative Factors", "Hidden cash"], correct: 2, explanation: "Monopolies and Utilities have stability that Z-Score formulas miss." },
        { q: "Who gets paid LAST in bankruptcy?", options: ["Secured Debt", "Unsecured Debt", "Suppliers", "Equity"], correct: 3, explanation: "Shareholders are residual claimants. They get whatever is left (usually nothing)." },
        { q: "What is a Covenant?", options: ["A religious group", "A loan rule/restriction", "A type of bond", "A tax credit"], correct: 1, explanation: "Covenants are rules (Do's and Don'ts) written into the loan contract." }
    ];

    let currentQ = 0;
    
    function loadQuiz() {
        const qData = quizData[currentQ];
        document.getElementById('quiz-question').innerText = qData.q;
        document.getElementById('quiz-progress').innerText = currentQ + 1;
        const optsDiv = document.getElementById('quiz-options');
        optsDiv.innerHTML = '';
        const fb = document.getElementById('quiz-feedback');
        fb.classList.remove('visible');
        fb.innerHTML = '';
        document.getElementById('next-q-btn').style.display = 'none';

        qData.options.forEach((opt, idx) => {
            const div = document.createElement('div');
            div.className = 'quiz-option';
            div.innerText = opt;
            div.onclick = () => checkAnswer(div, idx, qData.correct);
            optsDiv.appendChild(div);
        });
    }

    function checkAnswer(el, idx, correctIdx) {
        const opts = document.querySelectorAll('.quiz-option');
        const fb = document.getElementById('quiz-feedback');
        fb.classList.add('visible');
        
        if (idx === correctIdx) {
            el.classList.add('correct');
            fb.innerHTML = `<strong>Correct!</strong> ${quizData[currentQ].explanation}`;
            fb.style.borderColor = "var(--success)";
            fb.style.backgroundColor = "#e6fffa";
            fb.style.color = "var(--success)";
            opts.forEach(o => o.onclick = null);
            document.getElementById('next-q-btn').style.display = 'inline-block';
        } else {
            el.classList.add('incorrect');
            fb.innerHTML = `<strong>Try Again!</strong>`;
            fb.style.borderColor = "var(--error)";
            fb.style.backgroundColor = "#fff5f5";
            fb.style.color = "var(--error)";
        }
    }

    function nextQuestion() {
        currentQ++;
        if (currentQ < quizData.length) {
            loadQuiz();
        } else {
            document.getElementById('quiz-container').innerHTML = `
                <div style="text-align:center; padding:40px;">
                    <i class="fas fa-trophy" style="font-size:4rem; color:var(--warning); margin-bottom:20px;"></i>
                    <h3 style="color:var(--success);">Quiz Complete!</h3>
                    <p>You've mastered Credit Risk Analysis.</p>
                    <button class="btn-reveal" onclick="resetQuiz()">Start Over</button>
                </div>
            `;
        }
    }

    function resetQuiz() {
        currentQ = 0;
        // Rebuild container structure
        document.getElementById('quiz-container').innerHTML = `
            <p id="quiz-question" style="font-size: 1.3rem; margin-bottom: 25px; font-weight: 700; color: var(--text-main);"></p>
            <div id="quiz-options"></div>
            <div id="quiz-feedback" class="answer" style="margin-top: 15px;"></div>
            <button id="next-q-btn" onclick="nextQuestion()" class="btn-reveal" style="display:none; margin-top: 20px;">Next Question</button>
        `;
        loadQuiz();
    }

    // Initialize
    updateSlide();
    loadQuiz();

    document.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowRight') changeSlide(1);
        if (e.key === 'ArrowLeft') changeSlide(-1);
    });
</script>

</body>
</html>
