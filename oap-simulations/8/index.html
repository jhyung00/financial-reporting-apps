<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Reporting and Analysis Simulation</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        
        /* Custom Table Styles */
        .ref-table th, .ref-table td {
            padding: 6px 8px;
            font-size: 0.75rem;
            border-bottom: 1px solid #e5e7eb;
            vertical-align: middle;
        }
        .ref-table tr:hover { background-color: #f0f9ff; }
        .ref-table .val-cell { 
            text-align: right; 
            font-family: 'Roboto Mono', monospace; 
            cursor: pointer;
            color: #059669;
            transition: background-color 0.15s;
        }
        .ref-table .val-cell:hover { background-color: #d1fae5; font-weight: bold; }
        
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        .hint-popover {
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s, visibility 0.2s;
        }
        .group:hover .hint-popover {
            opacity: 1;
            visibility: visible;
        }

        /* Resize Handle Styles */
        .resize-handle {
            transition: background-color 0.2s;
        }
        .resize-handle:hover, .resize-handle:active {
            background-color: #3b82f6;
        }
    </style>
</head>
<body oncontextmenu="return false">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef, useCallback } = React;

        // --- DATA & CONSTANTS ---
        const RAW_DATA = [
            // PH Balance Sheet Assets
            {company: "PH", statement: "Balance Sheet", account: "Cash and cash equivalents", year: 2022, value: 535799},
            {company: "PH", statement: "Balance Sheet", account: "Cash and cash equivalents", year: 2021, value: 733117},
            {company: "PH", statement: "Balance Sheet", account: "Trade accounts receivable net", year: 2022, value: 2341504},
            {company: "PH", statement: "Balance Sheet", account: "Trade accounts receivable net", year: 2021, value: 2183594},
            {company: "PH", statement: "Balance Sheet", account: "Inventories", year: 2022, value: 2214553},
            {company: "PH", statement: "Balance Sheet", account: "Inventories", year: 2021, value: 2090642},
            {company: "PH", statement: "Balance Sheet", account: "Total current assets", year: 2022, value: 12046644},
            {company: "PH", statement: "Balance Sheet", account: "Total current assets", year: 2021, value: 5616750},
            {company: "PH", statement: "Balance Sheet", account: "Total assets", year: 2022, value: 25943943},
            {company: "PH", statement: "Balance Sheet", account: "Total assets", year: 2021, value: 20341200},
            
            // PH Balance Sheet Liabilities
            {company: "PH", statement: "Balance Sheet", account: "Accounts payable", year: 2022, value: 1731925},
            {company: "PH", statement: "Balance Sheet", account: "Accounts payable", year: 2021, value: 1667878},
            {company: "PH", statement: "Balance Sheet", account: "Accrued expenses", year: 2022, value: 470132},
            {company: "PH", statement: "Balance Sheet", account: "Accrued expenses", year: 2021, value: 507027},
            {company: "PH", statement: "Balance Sheet", account: "Accrued taxes", year: 2022, value: 250292},
            {company: "PH", statement: "Balance Sheet", account: "Accrued taxes", year: 2021, value: 236384},
            {company: "PH", statement: "Balance Sheet", account: "Other current liabilities", year: 2022, value: 1646636},
            {company: "PH", statement: "Balance Sheet", account: "Other current liabilities", year: 2021, value: 642197},
            {company: "PH", statement: "Balance Sheet", account: "Commercial paper", year: 2022, value: 1422000},
            {company: "PH", statement: "Balance Sheet", account: "Commercial paper", year: 2021, value: 0},
            {company: "PH", statement: "Balance Sheet", account: "Current portion of LT debt", year: 2022, value: 302280},
            {company: "PH", statement: "Balance Sheet", account: "Current portion of LT debt", year: 2021, value: 2819},
            {company: "PH", statement: "Balance Sheet", account: "Current lease liabilities", year: 2022, value: 36023},
            {company: "PH", statement: "Balance Sheet", account: "Current lease liabilities", year: 2021, value: 40193},
            {company: "PH", statement: "Balance Sheet", account: "Long-term debt (Noncurrent)", year: 2022, value: 9755825},
            {company: "PH", statement: "Balance Sheet", account: "Long-term debt (Noncurrent)", year: 2021, value: 6582053},
            {company: "PH", statement: "Balance Sheet", account: "Noncurrent lease liabilities", year: 2022, value: 100337},
            {company: "PH", statement: "Balance Sheet", account: "Noncurrent lease liabilities", year: 2021, value: 93904},
            {company: "PH", statement: "Balance Sheet", account: "Total equity", year: 2022, value: 8859920},
            {company: "PH", statement: "Balance Sheet", account: "Total equity", year: 2021, value: 8413670},

            // PH Income Statement
            {company: "PH", statement: "Income Statement", account: "Net sales", year: 2022, value: 15861608},
            {company: "PH", statement: "Income Statement", account: "Net sales", year: 2021, value: 14347640},
            {company: "PH", statement: "Income Statement", account: "Cost of sales", year: 2022, value: 11387267},
            {company: "PH", statement: "Income Statement", account: "Cost of sales", year: 2021, value: 10449680},
            {company: "PH", statement: "Income Statement", account: "Operating income", year: 2022, value: 2854346},
            {company: "PH", statement: "Income Statement", account: "Operating income", year: 2021, value: 2479990},
            {company: "PH", statement: "Income Statement", account: "Net income", year: 2022, value: 1315605},
            {company: "PH", statement: "Income Statement", account: "Net income", year: 2021, value: 1746100},

            // PH Cash Flow
            {company: "PH", statement: "Cash Flow Statement", account: "Net cash provided by operating activities", year: 2022, value: 2441730},
            {company: "PH", statement: "Cash Flow Statement", account: "Net cash provided by operating activities", year: 2021, value: 2575001},
            {company: "PH", statement: "Cash Flow Statement", account: "Net cash used for investing activities", year: 2022, value: -418837},
            {company: "PH", statement: "Cash Flow Statement", account: "Net cash used for investing activities", year: 2021, value: -13},
            {company: "PH", statement: "Cash Flow Statement", account: "Net cash provided by financing activities", year: 2022, value: 3915636},
            {company: "PH", statement: "Cash Flow Statement", account: "Net cash provided by financing activities", year: 2021, value: -2623339},
            {company: "PH", statement: "Cash Flow", account: "Shares purchased at cost (Repurchases)", year: 2022, value: -380334},
            {company: "PH", statement: "Cash Flow", account: "Shares purchased at cost (Repurchases)", year: 2021, value: -100000},

            // ITW Balance Sheet Assets
            {company: "ITW", statement: "Balance Sheet", account: "Cash and equivalents", year: 2022, value: 708},
            {company: "ITW", statement: "Balance Sheet", account: "Cash and equivalents", year: 2021, value: 1527},
            {company: "ITW", statement: "Balance Sheet", account: "Trade receivables", year: 2022, value: 3171},
            {company: "ITW", statement: "Balance Sheet", account: "Trade receivables", year: 2021, value: 2840},
            {company: "ITW", statement: "Balance Sheet", account: "Inventories", year: 2022, value: 2054},
            {company: "ITW", statement: "Balance Sheet", account: "Inventories", year: 2021, value: 1694},
            {company: "ITW", statement: "Balance Sheet", account: "Total current assets", year: 2022, value: 6270},
            {company: "ITW", statement: "Balance Sheet", account: "Total current assets", year: 2021, value: 6374},
            {company: "ITW", statement: "Balance Sheet", account: "Total assets", year: 2022, value: 15422},
            {company: "ITW", statement: "Balance Sheet", account: "Total assets", year: 2021, value: 16077},
            
            // ITW Balance Sheet Liabilities
            {company: "ITW", statement: "Balance Sheet", account: "Short-term debt", year: 2022, value: 1590},
            {company: "ITW", statement: "Balance Sheet", account: "Short-term debt", year: 2021, value: 778},
            {company: "ITW", statement: "Balance Sheet", account: "Accounts payable", year: 2022, value: 594},
            {company: "ITW", statement: "Balance Sheet", account: "Accounts payable", year: 2021, value: 585},
            {company: "ITW", statement: "Balance Sheet", account: "Current portion of operating lease liabilities", year: 2022, value: 55},
            {company: "ITW", statement: "Balance Sheet", account: "Current portion of operating lease liabilities", year: 2021, value: 61},
            {company: "ITW", statement: "Balance Sheet", account: "Accrued expenses", year: 2022, value: 1673},
            {company: "ITW", statement: "Balance Sheet", account: "Accrued expenses", year: 2021, value: 1587},
            {company: "ITW", statement: "Balance Sheet", account: "Cash dividends payable", year: 2022, value: 400},
            {company: "ITW", statement: "Balance Sheet", account: "Cash dividends payable", year: 2021, value: 382},
            {company: "ITW", statement: "Balance Sheet", account: "Income taxes payable", year: 2022, value: 147},
            {company: "ITW", statement: "Balance Sheet", account: "Income taxes payable", year: 2021, value: 77},
            {company: "ITW", statement: "Balance Sheet", account: "Liabilities held for sale", year: 2022, value: 1},
            {company: "ITW", statement: "Balance Sheet", account: "Liabilities held for sale", year: 2021, value: 0},
            {company: "ITW", statement: "Balance Sheet", account: "Long-term debt", year: 2022, value: 6173},
            {company: "ITW", statement: "Balance Sheet", account: "Long-term debt", year: 2021, value: 6909},
            {company: "ITW", statement: "Balance Sheet", account: "Deferred income taxes (liabilities)", year: 2022, value: 484},
            {company: "ITW", statement: "Balance Sheet", account: "Deferred income taxes (liabilities)", year: 2021, value: 654},
            {company: "ITW", statement: "Balance Sheet", account: "Noncurrent income taxes payable", year: 2022, value: 273},
            {company: "ITW", statement: "Balance Sheet", account: "Noncurrent income taxes payable", year: 2021, value: 365},
            {company: "ITW", statement: "Balance Sheet", account: "Long-term portion of operating lease liabilities", year: 2022, value: 131},
            {company: "ITW", statement: "Balance Sheet", account: "Long-term portion of operating lease liabilities", year: 2021, value: 133},
            {company: "ITW", statement: "Balance Sheet", account: "Other liabilities", year: 2022, value: 812},
            {company: "ITW", statement: "Balance Sheet", account: "Other liabilities", year: 2021, value: 920},
            {company: "ITW", statement: "Balance Sheet", account: "Total stockholders' equity", year: 2022, value: 3089},
            {company: "ITW", statement: "Balance Sheet", account: "Total stockholders' equity", year: 2021, value: 3626},

            // ITW Income Statement
            {company: "ITW", statement: "Income Statement", account: "Operating revenue", year: 2022, value: 15932},
            {company: "ITW", statement: "Income Statement", account: "Operating revenue", year: 2021, value: 14455},
            {company: "ITW", statement: "Income Statement", account: "Cost of revenue", year: 2022, value: 9429},
            {company: "ITW", statement: "Income Statement", account: "Cost of revenue", year: 2021, value: 8489},
            {company: "ITW", statement: "Income Statement", account: "Operating income", year: 2022, value: 3790},
            {company: "ITW", statement: "Income Statement", account: "Operating income", year: 2021, value: 3477},
            {company: "ITW", statement: "Income Statement", account: "Net income", year: 2022, value: 3034},
            {company: "ITW", statement: "Income Statement", account: "Net income", year: 2021, value: 2694},

            // ITW Cash Flow
            {company: "ITW", statement: "Cash Flow Statement", account: "Net cash provided by operating activities", year: 2022, value: 2348},
            {company: "ITW", statement: "Cash Flow Statement", account: "Net cash provided by operating activities", year: 2021, value: 2557},
            {company: "ITW", statement: "Cash Flow Statement", account: "Net cash used for investing activities", year: 2022, value: -110},
            {company: "ITW", statement: "Cash Flow Statement", account: "Net cash used for investing activities", year: 2021, value: -984},
            {company: "ITW", statement: "Cash Flow Statement", account: "Net cash used for financing activities", year: 2022, value: -3000},
            {company: "ITW", statement: "Cash Flow Statement", account: "Net cash used for financing activities", year: 2021, value: -2564},
            {company: "ITW", statement: "Cash Flow", account: "Repurchases of common stock", year: 2022, value: -1750},
            {company: "ITW", statement: "Cash Flow", account: "Repurchases of common stock", year: 2021, value: -1000},
            {company: "ITW", statement: "Cash Flow", account: "Dividends paid", year: 2022, value: -1542},
            {company: "ITW", statement: "Cash Flow", account: "Dividends paid", year: 2021, value: -1463},

             // Hidden Instructor Notes Data
            {company: "ITW", statement: "Notes", account: "Warranty liability (end of year)", year: 2022, value: 42},
            {company: "ITW", statement: "Notes", account: "Warranty liability (end of year)", year: 2021, value: 46},
            {company: "ITW", statement: "Notes", account: "Warranty settlements", year: 2022, value: 40},
            {company: "ITW", statement: "Notes", account: "Warranty settlements", year: 2021, value: 34},
            {company: "ITW", statement: "Notes", account: "Warranty expense", year: 2022, value: 40},
            {company: "ITW", statement: "Notes", account: "Warranty expense", year: 2021, value: 34},
            {company: "ITW", statement: "Notes", account: "Fair value of debt", year: 2022, value: 6228},

            // Market Data
            { company: "ITW", statement: "Market Data", account: "Stock Price at Year End", year: 2022, value: 220.30},
            { company: "ITW", statement: "Market Data", account: "Stock Price at Year End", year: 2021, value: 246.80},
            { company: "PH", statement: "Market Data", account: "Stock Price at Year End", year: 2022, value: 246.05},
            { company: "PH", statement: "Market Data", account: "Stock Price at Year End", year: 2021, value: 307.11},

            // Supplemental Data (EPS, Dividends) - Only visible in instructor mode logic
            { company: "ITW", statement: "Supplemental Data", account: "Dividends per share", year: 2022, value: 5.06}, 
            { company: "ITW", statement: "Supplemental Data", account: "Dividends per share", year: 2021, value: 4.72},
            { company: "ITW", statement: "Supplemental Data", account: "Basic EPS", year: 2022, value: 9.80},
            { company: "ITW", statement: "Supplemental Data", account: "Basic EPS", year: 2021, value: 8.55},
            { company: "ITW", statement: "Supplemental Data", account: "Diluted EPS", year: 2022, value: 9.77},
            { company: "ITW", statement: "Supplemental Data", account: "Diluted EPS", year: 2021, value: 8.51},
            { company: "ITW", statement: "Supplemental Data", account: "Weighted avg shares (Basic)", year: 2022, value: 309.6},
            { company: "ITW", statement: "Supplemental Data", account: "Weighted avg shares (Basic)", year: 2021, value: 315.1},
            { company: "ITW", statement: "Supplemental Data", account: "Weighted avg shares (Diluted)", year: 2022, value: 310.7},
            { company: "ITW", statement: "Supplemental Data", account: "Weighted avg shares (Diluted)", year: 2021, value: 316.4},
            { company: "ITW", statement: "Supplemental Data", account: "Antidilutive options", year: 2022, value: 0.9},
            { company: "ITW", statement: "Supplemental Data", account: "Antidilutive options", year: 2021, value: 0.4},

            { company: "PH", statement: "Supplemental Data", account: "Dividends per share", year: 2022, value: 4.42},
            { company: "PH", statement: "Supplemental Data", account: "Dividends per share", year: 2021, value: 3.67},
            { company: "PH", statement: "Supplemental Data", account: "Basic EPS", year: 2022, value: 10.24},
            { company: "PH", statement: "Supplemental Data", account: "Basic EPS", year: 2021, value: 13.54},
            { company: "PH", statement: "Supplemental Data", account: "Diluted EPS", year: 2022, value: 10.09},
            { company: "PH", statement: "Supplemental Data", account: "Diluted EPS", year: 2021, value: 13.35},
            { company: "PH", statement: "Supplemental Data", account: "Weighted avg shares (Basic)", year: 2022, value: 128539.387},
            { company: "PH", statement: "Supplemental Data", account: "Weighted avg shares (Basic)", year: 2021, value: 128999.879},
            { company: "PH", statement: "Supplemental Data", account: "Weighted avg shares (Diluted)", year: 2022, value: 130355.943},
            { company: "PH", statement: "Supplemental Data", account: "Weighted avg shares (Diluted)", year: 2021, value: 130834.478},
            { company: "PH", statement: "Supplemental Data", account: "Antidilutive options", year: 2022, value: 400},
            { company: "PH", statement: "Supplemental Data", account: "Antidilutive options", year: 2021, value: 400},

            {company: "PH", statement: "Notes", account: "Fair value of debt", year: 2022, value: 9709407},
        ];

        const LINKS = {
            PH: "https://www.sec.gov/ix?doc=/Archives/edgar/data/0000076334/000007633422000034/ph-20220630.htm",
            ITW: "https://www.sec.gov/ix?doc=/Archives/edgar/data/0000049826/000004982623000008/itw-20221231.htm"
        };

        // ==========================================
        // UTILITY FUNCTIONS
        // ==========================================

        const toPascalCase = (str) => 
            str.replace(/(^\w|-\w)/g, (clear) => clear.replace(/-/, "").toUpperCase());

        // Robust Icon component using Lucide's createIcons to ensure rendering
        const Icon = ({ name, size = 16, className = "" }) => {
            const ref = useRef(null);

            useEffect(() => {
                if (window.lucide && window.lucide.createIcons && ref.current) {
                    const iconName = name.toLowerCase().replace(/[A-Z]/g, letter => `-${letter.toLowerCase()}`);
                    ref.current.innerHTML = `<i data-lucide="${iconName}" style="width: ${size}px; height: ${size}px;"></i>`;
                    
                    window.lucide.createIcons({
                        root: ref.current,
                        attrs: {
                            class: className,
                            width: size,
                            height: size,
                            "stroke-width": 2
                        }
                    });
                }
            }, [name, size, className]);

            return <span ref={ref} className={`icon-fix inline-flex items-center justify-center ${className}`} style={{ width: size, height: size }} />;
        };

        // ==========================================
        // COMPONENTS
        // ==========================================

        const Sidebar = ({ onDataClick, activeTab, onTabChange, modules, isInstructor, width, isOpen, onToggle, isMobile }) => {
            const groupedData = useMemo(() => {
                const groups = {};
                RAW_DATA.forEach(row => {
                    // Only show "Supplemental Data" if instructor mode is ON
                    if (row.statement === "Supplemental Data" && !isInstructor) return;

                    if (!groups[row.company]) groups[row.company] = {};
                    if (!groups[row.company][row.statement]) groups[row.company][row.statement] = [];
                    groups[row.company][row.statement].push(row);
                });
                return groups;
            }, [isInstructor]);

            const [expandedCompany, setExpandedCompany] = useState("PH");

            return (
                <div 
                    style={{ width: isMobile ? '100%' : (isOpen ? width : '4rem') }}
                    className={`bg-white border-r border-gray-200 flex flex-col shadow-lg z-20 shrink-0 transition-width duration-200 ease-linear ${isMobile ? 'h-auto' : 'h-full'}`}
                >
                    
                    {/* SECTION 1: MODULE NAVIGATION */}
                    <div className="bg-slate-50 border-b border-gray-200 flex flex-col">
                        <div className="p-4 pb-2">
                            <div className="flex justify-between items-center mb-2">
                                {(isOpen || isMobile) && <h2 className="text-xs font-bold text-slate-500 uppercase tracking-wider flex items-center gap-2">
                                    <Icon name="list" size={14}/> Worksheet Modules
                                </h2>}
                                <button onClick={onToggle} className="p-1 hover:bg-slate-200 rounded ml-auto text-slate-600">
                                    {isMobile ? (
                                        isOpen ? <Icon name="chevron-up" size={16} /> : <Icon name="chevron-down" size={16} />
                                    ) : (
                                        <Icon name={isOpen ? "chevron-left" : "chevron-right"} size={16} />
                                    )}
                                </button>
                            </div>
                            
                            <div className={`${isOpen ? 'block' : (isMobile ? 'hidden' : 'hidden')} flex flex-col space-y-1 max-h-48 md:max-h-64 overflow-y-auto custom-scroll pr-1`}>
                                {modules.map((mod, idx) => (
                                    <button
                                        key={idx}
                                        onClick={() => onTabChange(idx)}
                                        className={`text-left text-sm px-3 py-2.5 rounded-md transition-all flex items-center justify-between group ${
                                            activeTab === idx 
                                            ? "bg-blue-600 text-white shadow-md font-semibold" 
                                            : "bg-white text-slate-600 hover:bg-blue-50 border border-transparent hover:border-blue-100"
                                        }`}
                                    >
                                        <span className="truncate pr-2">{mod.title}</span>
                                        {activeTab === idx && <Icon name="chevron-right" size={14} className="opacity-80" />}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>

                    {/* SECTION 2 & 3: CONTENT (Only when open) */}
                    <div className={`${isOpen ? 'flex flex-col flex-1 min-h-0' : (isMobile ? 'hidden' : 'hidden')}`}>
                        {/* SECTION 2: REFERENCE DATA HEADER */}
                        <div className="p-4 border-b border-gray-200 bg-white shrink-0">
                            <h2 className="text-lg font-bold text-slate-800 flex items-center gap-2">
                                <Icon name="database" /> Reference Data
                            </h2>
                            <p className="text-xs text-slate-500 mt-1">Click a value to insert into fields.</p>
                            
                            <div className="flex gap-2 mt-3">
                                <a href={LINKS.PH} target="_blank" className="flex-1 text-center text-xs bg-blue-100 text-blue-700 py-1 rounded hover:bg-blue-200 transition font-medium">
                                    PH 10-K
                                </a>
                                <a href={LINKS.ITW} target="_blank" className="flex-1 text-center text-xs bg-emerald-100 text-emerald-700 py-1 rounded hover:bg-emerald-200 transition font-medium">
                                    ITW 10-K
                                </a>
                            </div>
                        </div>

                        {/* SECTION 3: SCROLLABLE DATA LIST */}
                        <div className="flex-1 overflow-y-auto custom-scroll p-2 bg-slate-50">
                            {Object.keys(groupedData).map(company => (
                                <div key={company} className="mb-4">
                                    <button 
                                        onClick={() => setExpandedCompany(company === expandedCompany ? null : company)}
                                        className="w-full text-left font-bold bg-white border border-gray-200 px-3 py-2 rounded shadow-sm flex justify-between items-center hover:bg-slate-50 transition"
                                    >
                                        {company === "PH" ? "Parker Hannifin" : "Illinois Tool Works"}
                                        <Icon name={expandedCompany === company ? "chevron-down" : "chevron-right"} size={14} />
                                    </button>
                                    
                                    {expandedCompany === company && (
                                        <div className="pl-1 mt-1 space-y-4">
                                            {Object.keys(groupedData[company]).map(statement => (
                                                <div key={statement} className="bg-white/50 rounded p-1 border border-slate-100 mt-2">
                                                    <h4 className="text-[10px] font-bold text-blue-600 uppercase tracking-wider mb-2 mt-1 px-1 border-b border-blue-100 pb-1">
                                                        {statement}
                                                    </h4>
                                                    
                                                    {/* Header Row for Years */}
                                                    <div className="flex justify-between items-center text-[9px] font-bold text-slate-400 uppercase mb-1 px-2">
                                                        <span>Account</span>
                                                        <div className="flex gap-3">
                                                            <span className="w-14 text-right">2022</span>
                                                            <span className="w-14 text-right">2021</span>
                                                        </div>
                                                    </div>

                                                    <div className="space-y-0.5">
                                                        {(() => {
                                                            // Pivot logic just for display
                                                            const pivoted = {};
                                                            groupedData[company][statement].forEach(r => {
                                                                if (!pivoted[r.account]) pivoted[r.account] = { account: r.account };
                                                                pivoted[r.account][`y${r.year}`] = r.value;
                                                            });
                                                            
                                                            return Object.values(pivoted).map((row, idx) => (
                                                                <div key={idx} className="text-[11px] flex justify-between items-center group hover:bg-white p-1 rounded cursor-pointer border border-transparent hover:border-blue-200 hover:shadow-sm transition-all"
                                                                    title="Click to insert value"
                                                                >
                                                                    <span className="truncate flex-1 text-slate-600 group-hover:text-blue-700 pr-2">{row.account}</span>
                                                                    <div className="flex gap-3">
                                                                        {row.y2022 !== undefined && (
                                                                            <span 
                                                                                onClick={() => onDataClick(row.y2022)}
                                                                                className="w-14 text-right font-mono text-slate-700 hover:bg-blue-600 hover:text-white rounded px-1 transition cursor-pointer"
                                                                            >
                                                                                {row.y2022.toLocaleString()}
                                                                            </span>
                                                                        )}
                                                                        {row.y2021 !== undefined && (
                                                                            <span 
                                                                                onClick={() => onDataClick(row.y2021)}
                                                                                className="w-14 text-right font-mono text-slate-400 hover:bg-slate-200 hover:text-slate-800 rounded px-1 transition cursor-pointer"
                                                                            >
                                                                                {row.y2021.toLocaleString()}
                                                                            </span>
                                                                        )}
                                                                    </div>
                                                                </div>
                                                            ));
                                                        })()}
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        const SmartInput = ({ id, value, onChange, correctValue, isPct, onFocus, isInstructor }) => {
            const [localVal, setLocalVal] = useState(value || "");
            const [status, setStatus] = useState("neutral"); // neutral, correct, incorrect
            
            // Sync with parent value
            useEffect(() => {
                setLocalVal(value || "");
                if (value === undefined || value === "" || value === null) {
                    setStatus("neutral");
                } else {
                    validate(value);
                }
            }, [value]);

            const validate = (val) => {
                if (!val && val !== 0) return;
                
                let numVal = parseFloat(val);
                
                // Eval simple math expressions (e.g., 500/10)
                if (typeof val === 'string' && val.match(/[+\-*\/]/)) {
                     try {
                        numVal = Function('"use strict";return (' + val + ')')();
                     } catch(e) {}
                }

                if (isNaN(numVal)) {
                    setStatus("incorrect");
                    return;
                }
                
                const tolerance = 0.02; // 2% relative tolerance
                
                // Adaptive absolute tolerance: 
                // For small numbers (ratios < 10), use 0.01 floor. For larger, use 0.1 or purely relative.
                const floor = Math.abs(correctValue) < 10 ? 0.01 : 0.1;
                const absTolerance = Math.max(Math.abs(correctValue * tolerance), floor);
                
                let isValid = false;
                
                const check = (v) => Math.abs(v - correctValue) <= absTolerance;

                // 1. Exact match
                if (check(numVal)) isValid = true;

                // 2. Unit Confusion (x1000)
                if (!isValid) {
                    if (check(numVal * 1000)) isValid = true;
                    if (check(numVal / 1000)) isValid = true;
                }

                // 3. Percentage Logic
                if (!isValid && isPct) {
                    // User types decimal (0.13), Key is percent (13) -> 0.13 * 100 = 13
                    if (check(numVal * 100)) isValid = true;
                    // User types percent (13), Key is decimal (0.13) -> 13 / 100 = 0.13
                    if (check(numVal / 100)) isValid = true;
                }
                
                setStatus(isValid ? "correct" : "incorrect");
            };

            const handleBlur = (e) => {
                const val = e.target.value;
                let finalVal = val;

                // Evaluate math on blur
                if (typeof val === 'string' && val.match(/[+\-*\/]/)) {
                    try {
                        const calculated = Function('"use strict";return (' + val + ')')();
                        finalVal = parseFloat(calculated.toFixed(2));
                    } catch (e) {}
                }
                
                // Update parent and validate
                if (finalVal !== val) {
                    onChange(id, finalVal);
                    setLocalVal(finalVal); // Update local display
                    validate(finalVal);
                } else {
                    onChange(id, val); // Ensure parent has string if needed
                    validate(val);
                }
            };

            const handleKeyDown = (e) => {
                if (e.key === 'Enter') {
                    e.target.blur();
                }
            };

            let borderClass = "border-gray-300 focus:border-blue-500 focus:ring-blue-500";
            if (status === "correct") borderClass = "border-green-500 bg-green-50 text-green-700";
            if (status === "incorrect") borderClass = "border-red-400 bg-red-50 text-red-700";

            // Safety helper for displaying key
            const getKeyDisplay = () => {
                if (correctValue === undefined || correctValue === null) return "N/A";
                return isPct ? (correctValue * 100).toFixed(1) + '%' : correctValue.toLocaleString();
            };

            return (
                <div className="relative w-full mb-1">
                    <input
                        id={id}
                        type="text"
                        value={localVal}
                        onChange={(e) => {
                            setLocalVal(e.target.value);
                            onChange(id, e.target.value);
                        }}
                        onFocus={() => onFocus(id)}
                        onBlur={handleBlur}
                        onKeyDown={handleKeyDown}
                        placeholder={isPct ? "%" : "#"}
                        className={`w-full text-sm p-2 border rounded shadow-sm outline-none transition-colors font-mono ${borderClass}`}
                    />
                    <div className="absolute right-2 top-2.5 pointer-events-none">
                        {status === "correct" && <Icon name="check" size={14} className="text-green-600" />}
                        {status === "incorrect" && <Icon name="x" size={14} className="text-red-500" />}
                    </div>
                    {isInstructor && (
                        <div className="mt-1 px-2 py-1 bg-purple-100 text-purple-700 text-xs font-bold rounded border border-purple-200 inline-block">
                            Key: {correctValue}
                        </div>
                    )}
                </div>
            );
        };

        const InstructorModal = ({ isOpen, onClose, onUnlock }) => {
            const [pass, setPass] = useState("");
            if (!isOpen) return null;

            const handleLogin = () => {
                const _0x9b2 = ["T0FQOC1LZXk2UA=="];
                if (btoa(pass.trim()) === _0x9b2[0]) {
                    onUnlock();
                    onClose();
                    setPass("");
                } else {
                    alert("Incorrect Password");
                }
            };

            return (
                <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center">
                    <div className="bg-white p-6 rounded-lg shadow-xl w-80">
                        <h3 className="font-bold text-lg mb-4 flex items-center gap-2"><Icon name="lock" /> Instructor Access</h3>
                        <input 
                            type="password" 
                            className="w-full border p-2 rounded mb-4" 
                            placeholder="Password" 
                            value={pass}
                            onChange={(e) => setPass(e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && handleLogin()}
                        />
                        <div className="flex justify-end gap-2">
                            <button onClick={onClose} className="px-3 py-1 text-sm text-gray-500 hover:bg-gray-100 rounded">Cancel</button>
                            <button onClick={handleLogin} className="px-3 py-1 text-sm bg-purple-600 text-white rounded hover:bg-purple-700">Unlock</button>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [activeTab, setActiveTab] = useState(0);
            const [inputs, setInputs] = useState({});
            const [activeInputId, setActiveInputId] = useState(null);
            const [isInstructor, setIsInstructor] = useState(false);
            const [showModal, setShowModal] = useState(false);
            const [studentName, setStudentName] = useState("");
            const [confirmation, setConfirmation] = useState({ isOpen: false, message: '', onConfirm: null });
            
            // Layout States
            const [sidebarWidth, setSidebarWidth] = useState(384); // Default w-96
            const [isResizing, setIsResizing] = useState(false);
            const [isMobile, setIsMobile] = useState(false);
            const [isSidebarOpen, setIsSidebarOpen] = useState(true);

            // --- Layout Logic ---
            useEffect(() => {
                const checkMobile = () => {
                    const mobile = window.innerWidth < 768;
                    setIsMobile(mobile);
                    if (mobile) setIsSidebarOpen(false); // Default close on mobile
                    else setIsSidebarOpen(true);
                };
                checkMobile();
                window.addEventListener('resize', checkMobile);
                return () => window.removeEventListener('resize', checkMobile);
            }, []);

            const startResizing = useCallback(() => setIsResizing(true), []);
            const stopResizing = useCallback(() => setIsResizing(false), []);
            const resize = useCallback((mouseMoveEvent) => {
                if (isResizing) {
                    const newWidth = mouseMoveEvent.clientX;
                    if (newWidth > 200 && newWidth < 800) setSidebarWidth(newWidth);
                }
            }, [isResizing]);

            useEffect(() => {
                window.addEventListener("mousemove", resize);
                window.addEventListener("mouseup", stopResizing);
                return () => {
                    window.removeEventListener("mousemove", resize);
                    window.removeEventListener("mouseup", stopResizing);
                };
            }, [resize, stopResizing]);

            // --- Handlers ---

            const handleInputChange = (id, val) => {
                setInputs(prev => ({ ...prev, [id]: val }));
            };

            const handleFocus = (id) => {
                setActiveInputId(id);
            };

            // Core Logic: Sidebar Click-to-Fill
            const handleReferenceClick = (val) => {
                if (!activeInputId) return;
                
                const currentVal = String(inputs[activeInputId] || "").trim();
                const clickedVal = String(val);
                
                let newVal = "";

                // Check for operators at end of string
                const operatorRegex = /[+\-*/(]$/;
                
                if (operatorRegex.test(currentVal)) {
                    // Append
                    newVal = currentVal + clickedVal;
                } else if (currentVal === "") {
                    // Insert
                    newVal = clickedVal;
                } else {
                    // Default behavior: Assume addition if number exists
                    newVal = currentVal + "+" + clickedVal;
                }

                handleInputChange(activeInputId, newVal);
                
                // Attempt to re-focus the input
                setTimeout(() => {
                    const el = document.getElementById(activeInputId);
                    if (el) el.focus();
                }, 50);
            };

            const handleDownload = () => {
                let content = `Student Name: ${studentName || "Unknown"}\nDate: ${new Date().toLocaleString()}\n\n`;
                
                content += "--- ANSWERS ---\n";
                Object.keys(inputs).forEach(key => {
                    content += `${key}: ${inputs[key]}\n`;
                });

                const blob = new Blob([content], { type: "text/plain" });
                const url = URL.createObjectURL(blob);
                const a = document.createElement("a");
                a.href = url;
                a.download = `${studentName.replace(/\s+/g, '_')}_Financial_Analysis.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            };

            // Auto-fill logic (using the 'correctValue' from structure)
            const handleAutoFill = () => {
                setConfirmation({
                    isOpen: true,
                    message: "Are you sure you want to overwrite all answers with the key?",
                    onConfirm: () => {
                        const newInputs = {};
                        MODULES.forEach(mod => {
                            mod.sections.forEach(sec => {
                                sec.rows.forEach((row, rIdx) => {
                                    if (row.ph_2022_key !== undefined) newInputs[`${sec.id}_ph_22_r${rIdx}`] = row.ph_2022_key;
                                    if (row.ph_2021_key !== undefined) newInputs[`${sec.id}_ph_21_r${rIdx}`] = row.ph_2021_key;
                                    if (row.itw_2022_key !== undefined) newInputs[`${sec.id}_itw_22_r${rIdx}`] = row.itw_2022_key;
                                    if (row.itw_2021_key !== undefined) newInputs[`${sec.id}_itw_21_r${rIdx}`] = row.itw_2021_key;
                                });
                            });
                        });
                        setInputs(newInputs);
                        setConfirmation({ isOpen: false, message: '', onConfirm: null });
                    }
                });
            };

            const handleClear = () => {
                setConfirmation({
                    isOpen: true,
                    message: "Are you sure you want to clear all answers? This will also exit Instructor Mode.",
                    onConfirm: () => {
                        setInputs({});
                        setIsInstructor(false);
                        setConfirmation({ isOpen: false, message: '', onConfirm: null });
                    }
                });
            };

            // ==========================================
            // MODULE CONFIGURATION
            // ==========================================
            
            const MODULES = [
                {
                    title: "1. Equity Big Picture",
                    sections: [
                        {
                            title: "1.1 Percentage of Assets Financed by Owners vs. Nonowners",
                            id: "1.1",
                            isPct: true,
                            rows: [
                                { label: "% of assets financed by nonowners", ph_2022_key: 0.658, ph_2021_key: 0.586, itw_2022_key: 0.800, itw_2021_key: 0.774 },
                                { label: "% of assets financed by owners", ph_2022_key: 0.342, ph_2021_key: 0.414, itw_2022_key: 0.200, itw_2021_key: 0.226 }
                            ]
                        }
                    ],
                    observation: "Parker Hannifin is primarily financed by nonowners. Illinois Tool Works leverage increased over time, driven largely by aggressive share repurchases."
                },
                {
                    title: "2. Equity Accounts",
                    sections: [
                        {
                            title: "2.1 Preferred Stock",
                            id: "2.1",
                            note: "Consult the balance sheet and equity footnote.",
                            rows: [
                                { label: "Preferred shares authorized", ph_2022_key: 3000, ph_2021_key: 3000, itw_2022_key: 0.3, itw_2021_key: 0.3 },
                                { label: "Preferred shares outstanding", ph_2022_key: 0, ph_2021_key: 0, itw_2022_key: 0, itw_2021_key: 0 }
                            ]
                        },
                        {
                            title: "2.2 Common Stock Details",
                            id: "2.2",
                            note: "See balance sheet equity section and Equity Note.",
                            rows: [
                                { label: "Par value per share ($)", ph_2022_key: 0.50, ph_2021_key: 0.50, itw_2022_key: 0.01, itw_2021_key: 0.01 },
                                { label: "Shares authorized", ph_2022_key: 600000, ph_2021_key: 600000, itw_2022_key: 700, itw_2021_key: 700 },
                                { label: "Shares issued", ph_2022_key: 181046.128, ph_2021_key: 181046.128, itw_2022_key: 550, itw_2021_key: 550 },
                                { label: "Treasury shares", ph_2022_key: 52594.956, ph_2021_key: 51900.460, itw_2022_key: 245, itw_2021_key: 237.1 },
                                { label: "Shares outstanding", ph_2022_key: 128451.172, ph_2021_key: 129145.668, itw_2022_key: 305, itw_2021_key: 312.9 }
                            ]
                        }
                    ]
                },
                {
                    title: "3. Market Capitalization",
                    sections: [
                        {
                            title: "3.1 Market Capitalization at Year End",
                            id: "3.1",
                            rows: [
                                { label: "Shares outstanding", ph_2022_key: 128451.172, ph_2021_key: 129145.668, itw_2022_key: 305, itw_2021_key: 312.9 },
                                { label: "Stock price at year end ($)", ph_2022_key: 246.05, ph_2021_key: 307.11, itw_2022_key: 220.30, itw_2021_key: 246.80 },
                                { label: "Market capitalization", ph_2022_key: 31605410.87, ph_2021_key: 39661926.10, itw_2022_key: 67191.50, itw_2021_key: 77223.72 }
                            ]
                        }
                    ]
                },
                {
                    title: "4. Market-to-Book",
                    sections: [
                        {
                            title: "4.1 Market to Book Ratio",
                            id: "4.1",
                            note: "Hint: Market Capitalization / Total Stockholders' Equity",
                            rows: [
                                { label: "Market capitalization", ph_2022_key: 31605411, ph_2021_key: 39661926, itw_2022_key: 67192, itw_2021_key: 77224 },
                                { label: "Book value of equity", ph_2022_key: 8859920, ph_2021_key: 8413670, itw_2022_key: 3089, itw_2021_key: 3626 },
                                { label: "Market-to-book ratio", ph_2022_key: 3.57, ph_2021_key: 4.72, itw_2022_key: 21.75, itw_2021_key: 21.30 }
                            ]
                        }
                    ]
                },
                {
                    title: "5. Treasury Stock",
                    sections: [
                        {
                            title: "5.1 Treasury Stock Balances",
                            id: "5.1",
                            note: "Consult equity footnote and Statement of Cash Flows. Hint: Average price per share = Treasury stock $ / Treasury shares",
                            rows: [
                                { label: "Treasury stock ($ Balance Sheet)", ph_2022_key: 5688429, ph_2021_key: 5370605, itw_2022_key: 22377, itw_2021_key: 20636 },
                                { label: "Treasury shares at year end", ph_2022_key: 52595, ph_2021_key: 51900, itw_2022_key: 245, itw_2021_key: 237.1 },
                                { label: "Average price per share ($)", ph_2022_key: 108.16, ph_2021_key: 103.48, itw_2022_key: 91.33, itw_2021_key: 87.04 },
                                { label: "Cash paid for repurchases ($ SCF)", ph_2022_key: 380334, ph_2021_key: 0, itw_2022_key: 1750, itw_2021_key: 1000 },
                                { label: "Treasury shares repurchased", ph_2022_key: 1281.818, ph_2021_key: 0, itw_2022_key: 1.2, itw_2021_key: 0 },
                            ]
                        }
                    ]
                },
                {
                    title: "6. Dividends and Ratios",
                    sections: [
                        {
                            title: "6.1 Does the company pay dividends?",
                            id: "6.1",
                            note: "Check Statement of Cash Flows (Financing Activities).",
                            rows: [
                                { label: "Dividends paid ($ SCF)", ph_2022_key: 569855, ph_2021_key: 475174, itw_2022_key: 1542, itw_2021_key: 1463 },
                                { label: "Dividends per share ($)", ph_2022_key: 4.42, ph_2021_key: 3.67, itw_2022_key: 5.06, itw_2021_key: 4.72 }
                            ]
                        },
                        {
                            title: "6.2 Dividend Payout Ratio",
                            id: "6.2",
                            note: "Dividends per share: Check Statement of Equity. EPS: Check Income Statement. Dividend Payout Ratio = Dividends per share / Basic EPS",
                            rows: [
                                { label: "Dividends per share ($)", ph_2022_key: 4.42, ph_2021_key: 3.67, itw_2022_key: 5.06, itw_2021_key: 4.72 },
                                { label: "Basic earnings per share ($)", ph_2022_key: 10.24, ph_2021_key: 13.54, itw_2022_key: 9.80, itw_2021_key: 8.55 },
                                { label: "Dividend payout ratio", ph_2022_key: 0.432, ph_2021_key: 0.271, itw_2022_key: 0.516, itw_2021_key: 0.552, isPct: true }
                            ]
                        },
                        {
                            title: "6.3 Dividend Yield",
                            id: "6.3",
                            note: "Dividends: Statement of Equity. Stock Price: Market Data. Dividend Yield = Dividends per share / Stock Price",
                            rows: [
                                { label: "Dividends per share ($)", ph_2022_key: 4.42, ph_2021_key: 3.67, itw_2022_key: 5.06, itw_2021_key: 4.72 },
                                { label: "Stock price ($)", ph_2022_key: 246.05, ph_2021_key: 307.11, itw_2022_key: 220.30, itw_2021_key: 246.80 },
                                { label: "Dividend yield", ph_2022_key: 0.018, ph_2021_key: 0.012, itw_2022_key: 0.023, itw_2021_key: 0.019, isPct: true }
                            ]
                        },
                        {
                            title: "6.4 Verification of Dividends Per Share",
                            id: "6.4",
                            note: "Calculated as Dividends Paid / Shares Outstanding (Year End). Compare with reported value. Shares outstanding = Shares issued - Treasury stock. Consult Balance Sheet Stockholders' Equity section.",
                            rows: [
                                { label: "Dividends paid ($ SCF)", ph_2022_key: 569855, ph_2021_key: 475174, itw_2022_key: 1542, itw_2021_key: 1463 },
                                { label: "Shares outstanding (Year End)", ph_2022_key: 128451.172, ph_2021_key: 129145.668, itw_2022_key: 305, itw_2021_key: 312.9 },
                                { label: "Calculated Dividend per Share", ph_2022_key: 4.44, ph_2021_key: 3.68, itw_2022_key: 5.06, itw_2021_key: 4.67 },
                                { label: "Reported Dividend per Share", ph_2022_key: 4.42, ph_2021_key: 3.67, itw_2022_key: 5.06, itw_2021_key: 4.72 }
                            ]
                        }
                    ]
                },
                {
                    title: "7. Earnings Per Share (EPS)",
                    sections: [
                        {
                            title: "7.1 Basic EPS",
                            id: "7.1",
                            note: "Check Income Statement or EPS Note disclosure.",
                            rows: [
                                { label: "Net income (attr. to shareholders)", ph_2022_key: 1315605, ph_2021_key: 1746100, itw_2022_key: 3034, itw_2021_key: 2694 },
                                { label: "Weighted avg. shares (Basic)", ph_2022_key: 128539.387, ph_2021_key: 128999.879, itw_2022_key: 309.6, itw_2021_key: 315.1 },
                                { label: "Basic EPS ($)", ph_2022_key: 10.24, ph_2021_key: 13.54, itw_2022_key: 9.80, itw_2021_key: 8.55 }
                            ]
                        },
                        {
                            title: "7.2 Diluted EPS",
                            id: "7.2",
                            note: "Check Income Statement or EPS Note disclosure. Antidilutive options are excluded from diluted EPS calculation.",
                            rows: [
                                { label: "Net income (attr. to shareholders)", ph_2022_key: 1315605, ph_2021_key: 1746100, itw_2022_key: 3034, itw_2021_key: 2694 },
                                { label: "Weighted avg. shares (Diluted)", ph_2022_key: 130355.943, ph_2021_key: 130834.478, itw_2022_key: 310.7, itw_2021_key: 316.4 },
                                { label: "Diluted EPS ($)", ph_2022_key: 10.09, ph_2021_key: 13.35, itw_2022_key: 9.77, itw_2021_key: 8.51 },
                                { label: "Antidilutive options", ph_2022_key: 400, ph_2021_key: 400, itw_2022_key: 0.9, itw_2021_key: 0.4 }
                            ]
                        }
                    ]
                }
            ];

            return (
                <div className="flex flex-col md:flex-row h-screen overflow-hidden text-slate-800 relative">
                    
                    {/* Confirmation Modal */}
                    {confirmation.isOpen && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                            <div className="bg-white p-6 rounded-lg shadow-xl w-80 animate-in fade-in zoom-in duration-200">
                                <h3 className="font-bold text-lg mb-4 text-gray-800">Confirm Action</h3>
                                <p className="text-sm text-gray-600 mb-6">{confirmation.message}</p>
                                <div className="flex justify-end gap-2">
                                    <button onClick={() => setConfirmation({ isOpen: false, message: '', onConfirm: null })} className="px-3 py-1 text-sm text-gray-600 hover:bg-gray-100 rounded">Cancel</button>
                                    <button onClick={confirmation.onConfirm} className="px-3 py-1 bg-red-600 hover:bg-red-700 text-white rounded text-sm font-medium">Confirm</button>
                                </div>
                            </div>
                        </div>
                    )}

                    <Sidebar 
                        onDataClick={handleReferenceClick} 
                        activeTab={activeTab} 
                        onTabChange={setActiveTab} 
                        modules={MODULES} 
                        isInstructor={isInstructor}
                        width={sidebarWidth}
                        isOpen={isSidebarOpen}
                        onToggle={() => setIsSidebarOpen(!isSidebarOpen)}
                        isMobile={isMobile}
                    />

                    {/* Resize Handle (Desktop Only) */}
                    {!isMobile && isSidebarOpen && (
                        <div 
                            className="resize-handle w-1 h-full cursor-col-resize hover:bg-blue-400 active:bg-blue-600 z-30 hidden md:block"
                            onMouseDown={startResizing}
                        />
                    )}

                    <main className="flex-1 flex flex-col h-full overflow-hidden">
                        
                        {/* Header */}
                        <header className="bg-white border-b border-gray-200 px-6 py-4 flex flex-col md:flex-row justify-between items-start md:items-center shadow-sm z-10 gap-4 md:gap-0">
                            <div>
                                <h1 className="text-xl font-bold text-slate-800 flex items-center gap-2">
                                    <Icon name="bar-chart-2" className="text-blue-600"/> Financial Analysis Simulation
                                </h1>
                                <p className="text-sm text-slate-500">Parker Hannifin vs. Illinois Tool Works (2021-2022)</p>
                            </div>
                            <div className="flex items-center gap-4 w-full md:w-auto">
                                <input 
                                    type="text" 
                                    placeholder="Enter Student Name"
                                    className="border rounded px-3 py-1 text-sm focus:border-blue-500 outline-none w-full md:w-auto"
                                    value={studentName}
                                    onChange={(e) => setStudentName(e.target.value)}
                                />
                                <button 
                                    onClick={handleDownload}
                                    className="bg-blue-600 text-white px-4 py-1.5 rounded text-sm font-medium hover:bg-blue-700 flex items-center gap-2 transition shrink-0"
                                >
                                    <Icon name="download" size={16}/> Save Work
                                </button>
                                
                                <button 
                                    onClick={() => isInstructor ? handleClear() : setShowModal(true)}
                                    className={`px-3 py-1.5 rounded text-sm font-medium flex items-center gap-2 transition shrink-0 ${isInstructor ? "bg-purple-100 text-purple-700 hover:bg-purple-200" : "bg-slate-100 text-slate-600 hover:bg-slate-200"}`}
                                    title="Instructor Access"
                                >
                                    <Icon name={isInstructor ? "unlock" : "lock"} size={16} />
                                    <span className="hidden md:inline">{isInstructor ? "Instructor Mode" : "Instructor Access"}</span>
                                </button>
                            </div>
                        </header>

                        {/* Instructor Banner */}
                        {isInstructor && (
                            <div className="bg-purple-600 text-white px-6 py-2 text-sm flex flex-col md:flex-row justify-between items-center shadow-md z-10 gap-2 md:gap-0">
                                <span className="font-semibold flex items-center gap-2"><Icon name="shield-check" size={16}/> Instructor Mode Active</span>
                                <div className="flex gap-4">
                                    <button onClick={handleAutoFill} className="hover:bg-purple-700 px-3 py-1 rounded flex items-center gap-2 transition" title="Auto-fill all answers">
                                        <Icon name="zap" size={14}/> Auto-Fill All
                                    </button>
                                    <button onClick={handleClear} className="hover:bg-purple-700 px-3 py-1 rounded flex items-center gap-2 transition" title="Clear all and exit instructor mode">
                                        <Icon name="trash-2" size={14}/> Clear & Exit
                                    </button>
                                </div>
                            </div>
                        )}

                        {/* Module Content */}
                        <div className="flex-1 overflow-y-auto p-4 md:p-8 bg-slate-50 custom-scroll">
                            <div className="max-w-5xl mx-auto space-y-8">
                                
                                {MODULES[activeTab].observation && (
                                    <div className="bg-blue-50 border-l-4 border-blue-500 p-4 rounded text-sm text-blue-800">
                                        <strong>Observation:</strong> {MODULES[activeTab].observation}
                                    </div>
                                )}

                                {MODULES[activeTab].sections.map((section) => (
                                    <div key={section.id} className="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                                        <div className="mb-4">
                                            <h3 className="text-lg font-bold text-slate-800">{section.title}</h3>
                                            {section.note && <p className="text-sm text-slate-500 italic mt-1">{section.note}</p>}
                                        </div>

                                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                            {/* Parker Hannifin Column */}
                                            <div>
                                                <h4 className="font-bold text-blue-700 border-b-2 border-blue-100 pb-2 mb-4">
                                                    Parker Hannifin (PH) 
                                                    <span className="block text-xs font-normal text-slate-500 mt-0.5">($ thousands)</span>
                                                </h4>
                                                <div className="grid grid-cols-[1fr_80px_80px] gap-2 items-center text-sm font-semibold text-slate-500 mb-2">
                                                    <span>Item</span>
                                                    <span>2022</span>
                                                    <span>2021</span>
                                                </div>
                                                {section.rows.map((row, rIdx) => (
                                                    <div key={rIdx} className="grid grid-cols-[1fr_80px_80px] gap-2 items-start mb-3 py-2 border-b border-gray-50 last:border-0">
                                                        <span className="text-sm pt-2">{row.label}</span>
                                                        <SmartInput 
                                                            id={`${section.id}_ph_22_r${rIdx}`}
                                                            value={inputs[`${section.id}_ph_22_r${rIdx}`]}
                                                            correctValue={row.ph_2022_key}
                                                            onChange={handleInputChange}
                                                            onFocus={handleFocus}
                                                            isPct={row.isPct !== undefined ? row.isPct : section.isPct}
                                                            isInstructor={isInstructor}
                                                        />
                                                        <SmartInput 
                                                            id={`${section.id}_ph_21_r${rIdx}`}
                                                            value={inputs[`${section.id}_ph_21_r${rIdx}`]}
                                                            correctValue={row.ph_2021_key}
                                                            onChange={handleInputChange}
                                                            onFocus={handleFocus}
                                                            isPct={row.isPct !== undefined ? row.isPct : section.isPct}
                                                            isInstructor={isInstructor}
                                                        />
                                                    </div>
                                                ))}
                                            </div>

                                            {/* ITW Column */}
                                            <div>
                                                <h4 className="font-bold text-emerald-700 border-b-2 border-emerald-100 pb-2 mb-4">
                                                    Illinois Tool Works (ITW)
                                                    <span className="block text-xs font-normal text-slate-500 mt-0.5">($ millions)</span>
                                                </h4>
                                                <div className="grid grid-cols-[1fr_80px_80px] gap-2 items-center text-sm font-semibold text-slate-500 mb-2">
                                                    <span>Item</span>
                                                    <span>2022</span>
                                                    <span>2021</span>
                                                </div>
                                                {section.rows.map((row, rIdx) => (
                                                    <div key={rIdx} className="grid grid-cols-[1fr_80px_80px] gap-2 items-start mb-3 py-2 border-b border-gray-50 last:border-0">
                                                        <span className="text-sm pt-2">{row.label}</span>
                                                        <SmartInput 
                                                            id={`${section.id}_itw_22_r${rIdx}`}
                                                            value={inputs[`${section.id}_itw_22_r${rIdx}`]}
                                                            correctValue={row.itw_2022_key}
                                                            onChange={handleInputChange}
                                                            onFocus={handleFocus}
                                                            isPct={row.isPct !== undefined ? row.isPct : section.isPct}
                                                            isInstructor={isInstructor}
                                                        />
                                                        <SmartInput 
                                                            id={`${section.id}_itw_21_r${rIdx}`}
                                                            value={inputs[`${section.id}_itw_21_r${rIdx}`]}
                                                            correctValue={row.itw_2021_key}
                                                            onChange={handleInputChange}
                                                            onFocus={handleFocus}
                                                            isPct={row.isPct !== undefined ? row.isPct : section.isPct}
                                                            isInstructor={isInstructor}
                                                        />
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </main>

                    <InstructorModal 
                        isOpen={showModal} 
                        onClose={() => setShowModal(false)} 
                        onUnlock={() => setIsInstructor(true)} 
                    />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
